function trace(e){"\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((window.performance.now()/1e3).toFixed(3)+": "+e)}function maybeFixConfiguration(e){if(e)for(var t=0;t<e.iceServers.length;t++)e.iceServers[t].hasOwnProperty("urls")&&(e.iceServers[t].url=e.iceServers[t].urls,delete e.iceServers[t].urls)}function connectedStatus(){"undefined"==typeof dc||null===dc||"open"!==dc.readyState?console.log("No yet connected."):"open"===dc.readyState&&console.log("We are connected.")}function showDebugInfo(){var e=document.getElementsByClassName("debug");for(i=0;i<e.length;i++)e[i].className="debug"}function connectedToPeer(e){console.log("Great. Connected to peer via peer signaling channel, probably."),setStatus("Connected")}function connect(){var e,t,n;key=Seshi.getKey(),n=function(e){var t=document.getElementById("inmessages"),n=JSON.stringify(e).replace(/\\r\\n/g,"\n");t.value=n+"\n"+t.value,"offer"===e.type?(pc.setRemoteDescription(new RTCSessionDescription(e,function(){console.log("Sucess setRemoteDescription offer on connect()..")},function(){console.log("Failed setRemoteDescription offer on connect()...")})),answer()):"answer"===e.type?pc.setRemoteDescription(new RTCSessionDescription(e,function(){console.log("Sucess setRemoteDescription answer on connect..")},function(){console.log("Failed setRemoteDescription answer on connect...")})):"candidate"===e.type&&pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:e.mlineindex,candidate:e.candidate}),function(){console.log("Add iceCandidate sucess on connect() call..")},function(){console.log("error accing iceCanditation on connect() call..")})},t={onWaiting:function(){setStatus("Waiting"),weWaited=!0},onConnected:function(){setStatus("Connected"),createPC()},onMessage:n},signalingChannel=createSignalingChannel(key,t),e=function(e){document.getElementById("response").innerHTML=e},signalingChannel.connect(e)}function send(e){var t=function(e){document.getElementById("response").innerHTML=e},e=e||document.getElementById("message").value;msgE=document.getElementById("outmessages");var n=JSON.stringify(e).replace(/\\r\\n/g,"\n");msgE.value=n+"\n"+msgE.value,signalingChannel.send(e,t)}function createPC(){var e=!0,t=!1,n=function(e){return"0"===e||"false"===e||!e},r=new Array;queryparams="",queryparams&&("stunuri"in queryparams&&(e=!n(queryparams.stunuri)),"turnuri"in queryparams&&(t=!n(queryparams.turnuri))),e&&r.push({url:"turn:178.62.83.184:3478",username:"my_username",credential:"my_password"}),console.log("config = "+JSON.stringify(r)),window.pc=new RTCPeerConnection({iceServers:r}),window.pc.onicecandidate=onIceCandidate,window.pc.onaddstream=onRemoteStreamAdded,window.pc.onremovestream=onRemoteStreamRemoved,window.pc.ondatachannel=onDataChannelAdded,window.pc.oniceconnectionstatechange=onIceconnectionStateChanged,window.pc.onsignalingstatechange=onSignalingStateChanged,attachMediaIfReady()}function onIceCandidate(e){e.candidate&&send({type:"candidate",mlineindex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate})}function onRemoteStreamAdded(e){setStatus("On call")}function onIceconnectionStateChanged(e){console.log("Ice Connection State Change to: "+pc.iceConnectionState),("completed"==pc.iceConnectionState||"connected"==pc.iceConnectionState)&&(dispatchEvent(onPeerConnectionEstablished),localStorage.removeItem("key")),"disconnected"==pc.iceConnectionState&&dispatchEvent(onPeerConnectionBroken)}function onRemoteStreamRemoved(e){}function onDataChannelAdded(e){dc=e.channel,console.log("We are connected!"),setupDataHandlers(),Seshi.config.YoloInitMsg&&sendChat("Yolo! Seshi Init."),e.channel.onopen=function(){Seshi.sendLocalFileListToRemote()}}function onSignalingStateChanged(){console.log("Signaling State Changed to: "+pc.signalingState)}function setupDataHandlers(){data.send=function(e){e=JSON.stringify(e),console.log("Sending: "+e+" over data channel"),dc.send(e)},dc.onmessage=function(e){if(e.data instanceof Array&&alert("Is array"),console.log("We got: "+e.data),e.data instanceof ArrayBuffer||e.data.size?(console.log("Recieved ArrayBuffer message"),Seshi.recvBuffer.push(new Blob([e.data])),0==processRecieveBufferFLAG&&processRecieveBuffer()):JSON.parse(e.data)&&(fileMeta=JSON.parse(e.data)),"object"!=typeof e.data)var t=JSON.parse(e.data);else var t=e.data;if(cb=document.getElementById("chatbox"),rtt=document.getElementById("rtt"),t.cmd)switch(console.log("Interpreting command from remote peer.."),t.cmd){case"sendLocalFileListToRemote":Seshi.sendLocalFileListToRemote();break;case"recvRemoteFileList":Seshi.recvRemoteFileList(t);break;case"receivedChunkACK":trace("Peer told me that they've sucessfully received & stored a chunk I sent them. Yay."),Seshi.updateSendingProgress(t.data);break;case"requestFilesById":Seshi.sendRequestedFilesToPeer(t);break;case"remoteDisplayName":Seshi.setRemoteDisplayName(t);break;case"playInSyncRPC":Seshi.playInSyncRPC(t)}if(t.rtt)console.log("received rtt of '"+t.rtt+"'"),rtt.value=t.rtt,t=t.rtt;else if(t.requestFileId)console.log("Request for file recieved.");else if(t.chat){console.log("received chat of '"+t.chat+"'");var n=new Date;n=n.toString(),n=n.substring(0,21),chatData=filterXSS(t.chat,{whiteList:[],stripIgnoreTag:!0,stripIgnoreTagBody:["script"]});var r='<li class="clearfix">    <div class="message-data align-right">    <span class="message-data-time">'+n+'    <span class="message-data-name">'+t.remoteDisplayName+'    </span>    <i class="fa fa-circle me"></i></div>    <div class="message other-message float-right">'+chatData+"    </div></li>";cb.insertAdjacentHTML("beforeend",r),cb.scrollTop=cb.scrollHeight,t=t.chat,dispatchEvent(onNewChatMessage)}else t.storeData&&console.log("Received data store message.")}}function sendChat(e){var t=document.getElementById("chatbox"),n=document.getElementById("message-to-send");e=e||n.value,console.log("calling sendChat("+e+")");var r=new Date;r=r.toString(),r=r.substring(0,21),chatData=filterXSS(e,{whiteList:[],stripIgnoreTag:!0,stripIgnoreTagBody:["script"]});var i='<li><div class="message-data align-left">    <span class="message-data-name">        <i class="fa fa-circle online"></i> '+Seshi.getDisplayName()+'    </span><span class="message-data-time">'+r+'</span></div>    <div class="message my-message">'+chatData+"    </div></li>";t.insertAdjacentHTML("beforeend",i),data.send({chat:e,remoteDisplayName:Seshi.getDisplayName()}),n.value="",t.scrollTop=t.scrollHeight}function zeroFill(e,t){return t-=e.toString().length,t>0?new Array(t+(/\./.test(e)?2:1)).join("0")+e:e+""}function sendMostRecentFile(){localStorage.getItem("lastItem")&&(fileId=localStorage.getItem("lastItem"))}function trace(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}function attachMediaIfReady(){pc&&attachMedia()}function attachMedia(){setStatus("Ready for call")}function call(){dc=pc.createDataChannel("chat"),setupDataHandlers(),pc.createOffer(gotDescription,doNothing,constraints)}function answer(){pc.createAnswer(gotDescription,doNothing,constraints)}function gotDescription(e){console.log("Local Description type: "+e.type),console.log("Local Description sdp: "+e.sdp),pc.setLocalDescription(e,function(){console.log("Sucess setLocalDescription...")},function(e){console.log("Failed setLocalDescription...")}),send(e)}function setStatus(e){document.getElementById("statusline"),document.getElementById("status"),document.getElementById("send"),document.getElementById("connect"),document.getElementById("call"),document.getElementById("scMessage");switch(hangUp=document.getElementById("hangup"),e){case"Waiting":console.log("Sweet! Now send your friend this link: "+getShareLink()+" status: waiting");break;case"Connected":break;case"Ready for call":document.location.search&&console.log("Connecting to friend...");break;case"On call":console.log("On call")}}function log(e){console.log(e)}function getShareLink(){var e=Seshi.getKey();return document.location.origin+"/?key="+e}function getQueryVariable(e){for(var t=window.location.search.substring(1),n=t.split("&"),r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==e)return i[1]}return!1}function processRecieveBuffer(){if(0==Seshi.recvBuffer.length)return void(processRecieveBufferFLAG=!1);if(processRecieveBufferFLAG=!0,Seshi.recvBuffer.length>0){var e=Seshi.recvBuffer.pop(),t=e.slice(0,81),n=new FileReader;n.onload=function(t){if(n.readyState==FileReader.DONE){result2=t.target.result;var r=JSON.parse(result2),i=parseInt(r.metaLength);window.fileMetaLength=i,console.log("Meta length is:"+i);var o=e.slice(81,window.fileMetaLength+81),a=new FileReader;a.onload=function(t){if(a.readyState==FileReader.DONE){if(result=t.target.result,result.length>0){window.curChunk=JSON.parse(result);var n="File id: "+curChunk.fileId+" ChunkNumber: ";n+=curChunk.chunkNumber+" Filetype: "+curChunk.fileType,n+=" FileName: "+curChunk.fileName;var r=(curChunk.chunkNumber+1)/curChunk.numberOfChunks*100;100==r?statusMsg='Complete!: "'+curChunk.fileName+" 100%":statusMsg='Reciving file: "'+curChunk.fileName+'" Chunk number: '+curChunk.chunkNumber,statusE=document.getElementById("status"),statusE.innerHTML=statusMsg,curChunk.chunkNumber==curChunk.numberOfChunks&&refreshFileList("localFileList")}var i=81+window.fileMetaLength,o=e.slice(i),s={dataSource:"seshiChunk",boxId:Seshi.getBoxId(),chunk:o,chunkNumber:window.curChunk.chunkNumber,chunkSize:window.curChunk.chunkSize,fileId:window.curChunk.fileId,fileName:window.curChunk.fileName,fileType:window.curChunk.fileType,numberOfChunks:window.curChunk.numberOfChunks},c=new Promise(function(e,t){return StorageWorker.postMessage(s),StorageWorker.addEventListener("message",function(t){e(t.data)}),c});c.then(function(){var e={cmd:"receivedChunkACK",data:{boxId:Seshi.getBoxId(),fileId:window.curChunk.fileId,fileName:window.curChunk.fileName,fileType:window.curChunk.fileType,numberOfChunks:window.curChunk.numberOfChunks,chunkNumber:window.curChunk.chunkNumber,chunkSize:window.curChunk.chunkSize}};e=JSON.stringify(e),dc.send(e),processRecieveBuffer()})}},a.readAsText(o)}},n.readAsText(t)}}function tickAllFiles(e){n="checkAll-remoteFileList"==e?"remoteFileCheckBox":"localFileCheckBox";for(var t=document.getElementById(e).checked,n=document.getElementsByClassName(n),r=0;r<n.length;r++)n[r].checked=t}function peerConnectionBroken(){alert("Peer has disconnected"),alert("Hold on, we'll try and reconnect"),$("#remoteFileListContainer").fadeOut(),$("#sendIdThenHide").show(),$("connectionStatus").hide(),connect();var e=(document.getElementById("receiveBtn").disabled=!0,document.getElementById("sendBtn").disabled=!0,document.getElementById("chatToggle"));e.innerText="CHAT: Offline"}function createShareUrl(){Seshi.setKey();console.log("Generated share url: \n"+Seshi.getShareUrl()),connectToSignalServer(),replaceGenerateKeyBtn(),updateWhatsAppShareBtn();var e=document.getElementById("copyclipboard");e.dataset.shareurl=Seshi.getShareUrl(),new Clipboard("#copyclipboard",{text:function(e){return e.getAttribute("data-shareurl")}})}function connectToSignalServer(){connect()}function replaceGenerateKeyBtn(){generateKeyBtn=document.getElementById("connectionStatus");var e=document.createElement("p");e.id="connectionStatus",e.className="",connectBTnText=document.createTextNode("waiting for friend to receive key"),e.appendChild(connectBTnText);var t=generateKeyBtn.parentNode;t.replaceChild(e,generateKeyBtn)}function updateWhatsAppShareBtn(){var e=document.getElementsByClassName("whatsapp");e[0].href="whatsapp://send?text="+Seshi.getShareUrl()}function play(e){console.log("My player implimentation..."),void 0!==e.target.dataset?fileId=e.target.dataset.id:void 0!==e.detail.fileId.fileId?fileId=e.detail.fileId.fileId:void 0!==e.detail.fileId&&(fileId=e.detail.fileId),Seshi.generateObjectUrl(fileId).then(function(e){e.mimeType;e.mimeType.includes("audio")?($(".plyr").show(),mediaType="audio",$("#hideall").css("position","relative"),$(".plyr").css({position:"fixed",bottom:"0",width:"100%","z-index":"1001"}),$(".btn-hide").hide(),$("#hideall").removeClass("widthOpenVideo")):e.mimeType.includes("video")?(mediaType="video",$(".plyr").show(),$(window).width()>992?($(".plyr").css({position:"relative",width:"100%","z-index":"999"}),$("#hideall").css({position:"absolute",margin:"0 auto"}),$("#addfilehide").hide(),$("#hideall").hide(),$("#hideall").addClass("widthOpenVideo"),$("#addfilehide").addClass("showtoggle"),$("#hideall").addClass("showtoggle"),$(".btn-hide").show()):$(window).width()<992&&$(window).width()>768?($(".plyr").css({position:"fixed",bottom:"0",width:"62%","z-index":"1001"}),$("#hideall").css("position","relative"),$("#hideall").show(),$(".btn-hide").hide()):$(window).width()<768&&$(window).width()>480?($(".plyr").css({position:"fixed",bottom:"0",width:"72%","z-index":"1001"}),$("#hideall").show(),$(".btn-hide").hide()):$(window).width()<480&&($(".plyr").css({position:"fixed",bottom:"0",width:"100%","z-index":"1001"}),$("#hideall").show(),$(".btn-hide").hide())):($(".plyr").show(),mediaType="audio"),player.source({type:mediaType,title:e.fileName,sources:[{src:e.objectURL,type:e.mimeType}]}),player.play(),localStorage.setItem("currentlyPlaying",fileId)})}function pause(){var e=document.querySelector(".plyr");e.plyr.pause()}function resumePlay(){var e=document.querySelector(".plyr");e.plyr.play()}function download(e){fileId=e.target.dataset.id,Seshi.download(fileId)}function share(e){"open"==Seshi.connectionStatus.dataChannelState()?(fileId=e.target.dataset.id,Seshi.sendFileToPeer(fileId)):alert("You need to be connected to a peer in order to send them a file. Click button <x> or / automatically show share box to user...")}function refreshFileList(e){var t="throbber-"+e,n='<div id="'+t+'" class="ball-pulse"><div></div><div></div><div></div></div>';document.getElementById("header-"+e).insertAdjacentHTML("afterend",n),Seshi.updateLocalFilesList().then(function(n){document.getElementById(t).remove(),updateFileListDisplay(Seshi.localFileList(),e),"open"==Seshi.connectionStatus.dataChannelState()&&Seshi.sendLocalFileListToRemote()})}function storeFile(e){Seshi.store({dataSource:"fileSystem",data:e}),smoothScroll("shareButtonsRow")}function deleteFile(e){fileId=e.target.dataset.id,Seshi.deleteFile(fileId),refreshFileList("localFileList")}function showConnected(){$("#sendIdThenHide").hide(),$("#remoteFileListContainer").fadeIn(),(targetBtn=document.getElementById("connectionStatus"))||(targetBtn=document.getElementById("connect"));var e=document.createElement("p");e.id="connectionStatus",e.className="",connectedBtnText=document.createTextNode("Connected!"),e.appendChild(connectedBtnText);var t=targetBtn.parentNode;t.replaceChild(e,targetBtn),$("#connectionStatus").hide();var n=(document.getElementById("receiveBtn").disabled=!1,document.getElementById("sendBtn").disabled=!1,document.getElementById("chatToggle"));n.innerText="CHAT: Connected!"}function newChatMessageReceived(){console.log("newChatMessageReceived() called."),$("#message").fadeIn(),$(".btn-chat-toggle").on("click",function(){$("#message").fadeOut()})}function getFileTypeIcon(e){switch(e){case"audio/mp3":case"audio/ogg":return"fa-music";case"video/mp4":case"video/ogg":case"video/3gpp":case"video/x-msvideo":case"video/x-flv":return"fa-film";case"image/jpeg":case"image/png":case"image/svg+xml":return"fa-file-image-o";case"application/pdf":return"fa-file-pdf-o";case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"fa-file-word-o";case"text/html":case"text/css":return"fa-file-code-o";case"text/csv":case"text/plain":case"application/x-latex":case"application/x-tex":return"fa-file-text-o";default:return e}}function updateFileListDisplay(e,t){var n=e,r="";switch(t){case"localFileList":checkAllId="checkAll-localFileList";break;case"remoteFileList":checkAllId="checkAll-remoteFileList"}n&&console.log("There are "+n.length+" "+t+" files");for(var i=0;i<n.length;i++){var o=n[i].fileId,a=n[i].fileName,s=n[i].fileType,c="localFileList"==t?"localFileCheckBox":"remoteFileCheckBox";r+='<li class="list-group-item file-item row">\n',r+='<input class="col-xs-1 '+c+'" type="checkbox" id="'+o+'" data-id="'+o+'">\n',r+='<label class="col-xs-6 table-border name-label" for="'+o+'">'+a+"</label>\n",r+='<label class="col-xs-2 name-label" for="'+o+'"><i class="fa '+getFileTypeIcon(s)+'"></i></label>',"remoteFileList"!=t&&(r+='<div class="col-xs-1 hidden-xs"><i title="Delete" onclick="deleteFile(event)" data-id="'+o+'" class="fa fa-trash  "></i></div>',r+=Seshi.isPlayable(s,a)?'<div class="col-xs-1 playoptions"><a title="Play"><i onclick="play(event)" data-id="'+o+'" class="fa fa-play"></i></a></div>':'<div class="col-xs-1 "></div>',r+='<div class="col-xs-1 "><i onclick="download(event)" title="Download" data-id="'+o+'" class="fa fa-arrow-down"></i></div>'),r+="</li>"}for(var l=document.getElementById(t),u=l.children.length,i=1;u>i;i++)l.removeChild(l.children[0]);l.innerHTML=r}function updateStoreProgressDisplay(){for(var e in Seshi.storeProgress)if(0==Seshi.storeProgress[e].UIdone){Seshi.storeProgress[e];var t=Seshi.storeProgress[e].fileName,n=parseInt((Seshi.storeProgress[e].currentChunk+1)/Seshi.storeProgress[e].totalNumChunks*100),r=Seshi.storeProgress[e].totalNumChunks,i=(Seshi.storeProgress[e].complete,"");i+='<li class="list-group-item file-item uploading-item row" id="storingFileId-'+e+'">',i+='<div class="col-xs-4 col-sm-4 name-label">'+t+"</div> ",i+='<div class="col-xs-6  col-sm-6">',i+='<div class="uploading active" role="progressbar" aria-valuenow="'+n+'" aria-valuemin="0" aria-valuemax="100" style="width: 100%">',i+='<span class="uploadbar" style="width: '+n+'%;"></span>',i+="</div>",i+="</div>",i+='<div class="col-xs-1 col-sm-1">',i+='<div id="percentupload">'+n+"%</div>",i+="</div>",i+="</li>",n>=100?(document.getElementById("storingFileId-"+e)?(document.getElementById("storingFileId-"+e).remove(),refreshFileList("localFileList")):1==r&&refreshFileList("localFileList"),Seshi.storeProgress[e].UIdone=!0):(document.getElementById("storingFileId-"+e)&&document.getElementById("storingFileId-"+e).remove(),document.getElementById("localFileList").insertAdjacentHTML("afterbegin",i))}}function sendSelectedFiles(){var e=document.getElementsByClassName("localFileCheckBox");if("connected"==Seshi.connectionStatus.iceConnectionState()||"completed"==Seshi.connectionStatus.iceConnectionState()){for(var t=0;t<e.length;t++)1==e[t].checked&&Seshi.sendFileToPeer(e[t].dataset.id);for(var t=0;t<e.length;t++)e[t].checked=!1}}function deleteSelectedFiles(){for(var e=document.getElementsByClassName("localFileCheckBox"),t=0;t<e.length;t++)1==e[t].checked&&Seshi.deleteFile(e[t].dataset.id);refreshFileList("localFileList")}function downloadSelectedFiles(){for(var e=document.getElementsByClassName("localFileCheckBox"),t=0;t<e.length;t++)1==e[t].checked&&Seshi.download(e[t].dataset.id)}function pullSelectedFiles(){for(var e=document.getElementsByClassName("remoteFileCheckBox"),t=[],n=0;n<e.length;n++)1==e[n].checked&&t.push({fileId:e[n].dataset.id,requestType:"ALL"});t.length>0&&Seshi.requestFilesFromPeer(t)}function updateSendFileProgessDisplay(){for(var e in Seshi.sendingFileProgress)if(1!=Seshi.sendingFileProgress[e].UIdone){var t=Seshi.sendingFileProgress[e],n=t.fileName,r=(t.fileType,t.chunkNumber,t.numberOfChunks),i=parseInt((t.recvChunkCount+1)/r*100),o=(t.recvChunkCount>=r?!0:!1,"");o+='<li class="list-group-item file-item uploading-item row" id="sendingFileId-'+e+'">',o+='<div class="col-xs-4 col-sm-3">'+n+"</div> ",o+='<div class="col-xs-5  col-sm-6">',o+='<div class="uploading active" role="progressbar" aria-valuenow="'+i+'" aria-valuemin="0" aria-valuemax="100" style="width: 100%">',o+='<span class="uploadbar" style="width: '+i+'%;"></span>',o+="</div>",o+="</div>",o+='<div class="col-xs-1 col-sm-1">',o+='<div id="percentupload">'+i+"%</div>",o+="</div>",o+='<div class="col-xs-1 col-sm-1">',o+='<i class="fa fa-times "></i>',o+="</div>",o+='<div class="col-xs-1 col-sm-1"></div>',o+="</li>",i>=100?(Seshi.sendingFileProgress[e].UIdone=!0,document.getElementById("sendingFileId-"+e)&&document.getElementById("sendingFileId-"+e).remove()):(document.getElementById("sendingFileId-"+e)&&document.getElementById("sendingFileId-"+e).remove(),document.getElementById("remoteFileList").insertAdjacentHTML("afterbegin",o))}}function setDisplayName(e){if(13==e.keyCode||"blur"==e.type){var t=document.getElementById("display-name").value;Seshi.setDisplayName(t)}}function showRemoteDisplayName(){var e=document.getElementById("remoteDisplayName");e.innerHTML=Seshi.getRemoteDisplayName()}function smoothScroll(e){function t(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function n(e){for(var t=document.getElementById(e),n=t.offsetTop,r=t;r.offsetParent&&r.offsetParent!=document.body;)r=r.offsetParent,n+=r.offsetTop;return n}var r=t(),i=n(e),o=i>r?i-r:r-i;if(100>o)return void scrollTo(0,i);var a=Math.round(o/10);a>=20&&(a=20);var s=Math.round(o/25),c=i>r?r+s:r-s,l=0;if(i>r)for(var u=r;i>u;u+=s)setTimeout("window.scrollTo(0, "+c+")",l*a),c+=s,c>i&&(c=i),l++;else for(var u=r;u>i;u-=s)setTimeout("window.scrollTo(0, "+c+")",l*a),c-=s,i>c&&(c=i),l++}(function(e,t,n){"use strict";function r(e,t){return"object"!=typeof t&&(t=t()),Object.keys(t).forEach(function(n){e[n]=t[n]}),e}function i(e){return{from:function(t){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,{extend:function(n){r(e.prototype,"object"!=typeof n?n(t.prototype):n)}}}}}function o(e,t){return t(e)}function a(e,t){function u(){Pe.on("versionchange",function(e){Pe.close(),Pe.on("error").fire(new ge("Database version changed by other database connection."))})}function h(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function v(e,t,n,r){if(0===e){Object.keys(pe).forEach(function(e){C(t,e,pe[e].primKey,pe[e].indexes)});var i=Pe._createTransaction(Ie,ye,pe);i.idbtrans=t,i.idbtrans.onerror=F(n,["populating database"]),i.on("error").subscribe(n),M.newPSD(function(){M.PSD.trans=i;try{Pe.on("populate").fire(i)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(o){}t.db.close(),n(e)}})}else{var a=[],s=me.filter(function(t){return t._cfg.version===e})[0];if(!s)throw new ge("Dexie specification of currently installed DB version is missing");pe=Pe._dbSchema=s._cfg.dbschema;var c=!1,l=me.filter(function(t){return t._cfg.version>e});l.forEach(function(e){var r=pe,i=e._cfg.dbschema;ce(r,t),ce(i,t),pe=Pe._dbSchema=i;var s=S(r,i);s.add.forEach(function(e){a.push(function(t,n){C(t,e[0],e[1].primKey,e[1].indexes),n()})}),s.change.forEach(function(e){if(e.recreate)throw new ge("Not yet support for changing primary key");a.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){$(r,e)}),e.change.forEach(function(e){r.deleteIndex(e.name),$(r,e)}),e.del.forEach(function(e){r.deleteIndex(e)}),n()})}),e._cfg.contentUpgrade&&a.push(function(t,r){c=!0;var a=Pe._createTransaction(Ie,[].slice.call(t.db.objectStoreNames,0),i);a.idbtrans=t;var s=0;a._promise=o(a._promise,function(e){return function(t,n,i){function o(e){return function(){e.apply(this,arguments),0===--s&&r()}}return++s,e.call(this,t,function(e,t,r){arguments[0]=o(e),arguments[1]=o(t),n.apply(this,arguments)},i)}}),t.onerror=F(n,["running upgrader function for version",e._cfg.version]),a.on("error").subscribe(n),e._cfg.contentUpgrade(a),0===s&&r()}),c&&ae()||a.push(function(e,t){U(i,e),t()})});var u=function(){try{a.length?a.shift()(t,u):D(pe,t)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(i){}t.db.close(),n(e)}};u()}}function S(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(var r in t){var i=e[r],o=t[r];if(i){var a={name:r,def:t[r],recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)a.recreate=!0,n.change.push(a);else{var s=i.indexes.reduce(function(e,t){return e[t.name]=t,e},{}),c=o.indexes.reduce(function(e,t){return e[t.name]=t,e},{});for(var l in s)c[l]||a.del.push(l);for(var l in c){var u=s[l],d=c[l];u?u.src!==d.src&&a.change.push(d):a.add.push(d)}(a.recreate||a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,o])}return n}function C(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){$(i,e)}),i}function D(e,t){Object.keys(e).forEach(function(n){t.db.objectStoreNames.contains(n)||C(t,n,e[n].primKey,e[n].indexes)})}function U(e,t){for(var r=0;r<t.db.objectStoreNames.length;++r){var i=t.db.objectStoreNames[r];(null===e[i]||e[i]===n)&&t.db.deleteObjectStore(i)}}function $(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function H(e,t){throw new ge("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+a.Promise.PSD.trans.scopeFunc.toString())}function z(e,t,n,r){this.name=e,this.schema=n,this.hook=ve[e]?ve[e].hook:y(null,{creating:[d,s],reading:[l,c],updating:[f,s],deleting:[p,s]}),this._tpf=t,this._collClass=r||G}function J(e,t,n,r){z.call(this,e,t,n,r||Y)}function W(e,t,n,r){function i(e,t,n,r){return o._promise(e,n,r)}var o=this;this.db=Pe,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=y(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=n,r&&(this.parent=r),this._tpf=i,this.tables=Object.create(be);for(var a=t.length-1;-1!==a;--a){var s=t[a],c=Pe._tableFactory(e,n[s],i);this.tables[s]=c,this[s]||(this[s]=c)}}function V(e,t,n){this._ctx={table:e,index:":id"===t?null:t,collClass:e._collClass,or:n}}function G(e,t){var n=null,r=null;if(t)try{n=t()}catch(i){r=i}var o=e._ctx;this._ctx={table:o.table,index:o.index,isPrimKey:!o.index||o.table.schema.primKey.keyPath&&o.index===o.table.schema.primKey.name,range:n,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:1/0,error:r,or:o.or}}function Y(){G.apply(this,arguments)}function X(e,t){return e._cfg.version-t._cfg.version}function Q(e,t,n,r,i,o){n.forEach(function(n){var a=Pe._tableFactory(r,i[n],t);e.forEach(function(e){e[n]||(o?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){var e=M.PSD&&M.PSD.trans;return e&&e.db===Pe?e.tables[n]:a}}):e[n]=a)})})}function Z(e){e.forEach(function(e){for(var t in e)e[t]instanceof z&&delete e[t]})}function ee(e,t,n,r,i,o){var a=M.PSD;o=o||c,e.onerror||(e.onerror=F(i)),t?e.onsuccess=w(function(a){var s=e.result;if(s){var c=function(){s["continue"]()};t(s,function(e){c=e},r,i)&&n(o(s.value),s,function(e){c=e}),c()}else r()},i,a):e.onsuccess=w(function(t){var i=e.result;if(i){var a=function(){i["continue"]()};n(o(i.value),i,function(e){a=e}),a()}else r()},i,a)}function te(e){var t=[];return e.split(",").forEach(function(e){e=e.trim();var n=e.replace("&","").replace("++","").replace("*",""),r=0!==n.indexOf("[")?n:e.substring(e.indexOf("[")+1,e.indexOf("]")).split("+");t.push(new B(n,r||null,-1!==e.indexOf("&"),-1!==e.indexOf("*"),-1!==e.indexOf("++"),Array.isArray(r),-1!==r.indexOf(".")))}),t}function ne(e,t){return t>e?-1:e>t?1:0}function re(e,t){return t>e?1:e>t?-1:0}function ie(e){return function(t,n){for(var r=0;;){var i=e(t[r],n[r]);if(0!==i)return i;if(++r,r===t.length||r===n.length)return e(t.length,n.length)}}}function oe(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function ae(){return navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0}function se(){if(Pe.verno=Se.version/10,Pe._dbSchema=pe={},ye=[].slice.call(Se.objectStoreNames,0),0!==ye.length){var e=Se.transaction(R(ye),"readonly");ye.forEach(function(t){for(var n=e.objectStore(t),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),o=new B(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),a=[],s=0;s<n.indexNames.length;++s){var c=n.index(n.indexNames[s]);r=c.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf(".");var l=new B(c.name,r,!!c.unique,!!c.multiEntry,!1,r&&"string"!=typeof r,i);a.push(l)}pe[t]=new L(t,o,a,{})}),Q([ve],Pe._transPromiseFactory,Object.keys(pe),Ie,pe)}}function ce(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r)for(var i=n[r],o=t.objectStore(i),a=0;a<o.indexNames.length;++a){var s=o.indexNames[a],c=o.index(s).keyPath,l="string"==typeof c?c:"["+[].slice.call(c).join("+")+"]";if(e[i]){var u=e[i].idxByName[l];u&&(u.name=s)}}}var le=t&&t.addons||a.addons,ue=a.dependencies,de=ue.indexedDB,fe=ue.IDBKeyRange,he=(ue.IDBTransaction,ue.DOMError,ue.TypeError),ge=ue.Error,pe=this._dbSchema={},me=[],ye=[],ve={},be={},Se=null,we=!0,ke=null,xe=!1,Ce="readonly",Ie="readwrite",Pe=this,Te=[],De=!0,Ee=!!j();this.version=function(e){if(Se)throw new ge("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=me.filter(function(t){return t._cfg.version===e})[0];return t?t:(t=new h(e),me.push(t),me.sort(X),t)},r(h.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?r(this._cfg.storesSource,e):e;var t={};me.forEach(function(e){r(t,e._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),pe=Pe._dbSchema=n,Z([ve,Pe,be]),Q([be],H,Object.keys(n),Ie,n),Q([ve,Pe,this._cfg.tables],Pe._transPromiseFactory,Object.keys(n),Ie,n,!0),ye=Object.keys(n),this},upgrade:function(e){var t=this;return q(function(){e(Pe._createTransaction(Ie,Object.keys(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){Object.keys(e).forEach(function(n){if(null!==e[n]){var r={},i=te(e[n]),o=i.shift();if(o.multi)throw new ge("Primary key cannot be multi-valued");o.keyPath&&x(r,o.keyPath,o.auto?0:o.keyPath),i.forEach(function(e){if(e.auto)throw new ge("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ge("Index must have a name and cannot be an empty string");x(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),t[n]=new L(n,o,i,r)}})}}),this._allTables=ve,this._tableFactory=function(e,t,n){return e===Ce?new z(t.name,n,t,G):new J(t.name,n,t)},this._createTransaction=function(e,t,n,r){return new W(e,t,n,r)},this._transPromiseFactory=function(e,t,n){if(!we||M.PSD&&M.PSD.letThrough){var r=Pe._createTransaction(e,t,pe);return r._promise(e,function(e,t){r.error(function(e){Pe.on("error").fire(e)}),n(function(t){r.complete(function(){e(t)})},t,r)})}var i=new M(function(r,o){Te.push({resume:function(){var a=Pe._transPromiseFactory(e,t,n);i.onuncatched=a.onuncatched,a.then(r,o)}})});return i},this._whenReady=function(e){return new M(K||!we||M.PSD&&M.PSD.letThrough?e:function(t,n){Te.push({resume:function(){e(t,n)}})})},this.verno=0,this.open=function(){return new M(function(t,n){function r(e){try{i.transaction.abort()}catch(t){}xe=!1,ke=e,we=!1,n(ke),Te.forEach(function(e){e.resume()}),Te=[]}if(K&&t(Pe),Se||xe)throw new ge("Database already opened or being opened");var i,o=!1;try{if(ke=null,xe=!0,me.length>0&&(De=!1),!de)throw new ge("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(i=De?de.open(e):de.open(e,Math.round(10*Pe.verno)),!i)throw new ge("IndexedDB API not available");i.onerror=F(r,["opening database",e]),i.onblocked=function(e){Pe.on("blocked").fire(e)},i.onupgradeneeded=w(function(t){if(De&&!Pe._allowEmptyDB){i.onerror=function(e){e.preventDefault()},i.transaction.abort(),i.result.close();var n=de.deleteDatabase(e);n.onsuccess=n.onerror=function(){r(new ge("Database '"+e+"' doesnt exist"))}}else{0===t.oldVersion&&(o=!0),i.transaction.onerror=F(r);var a=t.oldVersion>Math.pow(2,62)?0:t.oldVersion;v(a/10,i.transaction,r,i)}},r),i.onsuccess=w(function(n){xe=!1,Se=i.result,De?se():Se.objectStoreNames.length>0&&ce(pe,Se.transaction(R(Se.objectStoreNames),Ce)),
Se.onversionchange=Pe.on("versionchange").fire,Ee||N(function(t){return-1===t.indexOf(e)?t.push(e):void 0}),M.newPSD(function(){function e(){we=!1,Te.forEach(function(e){e.resume()}),Te=[],t(Pe)}M.PSD.letThrough=!0;try{var n=Pe.on.ready.fire();n&&"function"==typeof n.then?n.then(e,function(e){Se.close(),Se=null,r(e)}):b(e)}catch(i){r(i)}})},r)}catch(a){r(a)}})},this.close=function(){Se&&(Se.close(),Se=null,we=!0,ke=null)},this["delete"]=function(){var t=arguments;return new M(function(n,r){function i(){Pe.close();var t=de.deleteDatabase(e);t.onsuccess=function(){Ee||N(function(t){var n=t.indexOf(e);return n>=0?t.splice(n,1):void 0}),n()},t.onerror=F(r,["deleting",e]),t.onblocked=function(){Pe.on("blocked").fire()}}if(t.length>0)throw new ge("Arguments not allowed in db.delete()");xe?Te.push({resume:i}):i()})},this.backendDB=function(){return Se},this.isOpen=function(){return null!==Se},this.hasFailed=function(){return null!==ke},this.dynamicallyOpened=function(){return De},this.name=e,Object.defineProperty(this,"tables",{get:function(){return Object.keys(ve).map(function(e){return ve[e]})}}),this.on=y(this,"error","populate","blocked",{ready:[m,s],versionchange:[g,s]}),this.on.ready.subscribe=o(this.on.ready.subscribe,function(e){return function(t,n){function r(){return n||Pe.on.ready.unsubscribe(r),t.apply(this,arguments)}e.call(this,r),Pe.isOpen()&&(we?Te.push({resume:r}):r())}}),q(function(){Pe.on("populate").fire(Pe._createTransaction(Ie,ye,pe)),Pe.on("error").fire(new ge)}),this.transaction=function(e,t,n){function r(t,r){var a=null;try{if(c)throw c;a=Pe._createTransaction(e,l,pe,i);var s=l.map(function(e){return a.tables[e]});s.push(a);var u,d=0;M.newPSD(function(){M.PSD.trans=a,a.scopeFunc=n,i&&(a.idbtrans=i.idbtrans,a._promise=o(a._promise,function(e){return function(t,n,r){function i(e){return function(t){var n;return M._rootExec(function(){n=e(t),M._tickFinalize(function(){0===--d&&a.active&&(a.active=!1,a.on.complete.fire())})}),n}}return++d,e.call(this,t,function(e,t,r){return n(i(e),i(t),r)},r)}})),a.complete(function(){t(u)}),a.error(function(e){a.idbtrans&&(a.idbtrans.onerror=O);try{a.abort()}catch(t){}i&&(i.active=!1,i.on.error.fire(e));var n=r(e);i||n||Pe.on.error.fire(e)}),M._rootExec(function(){u=n.apply(a,s)})}),(!a.idbtrans||i&&0===d)&&a._nop()}catch(f){a&&a.idbtrans&&(a.idbtrans.onerror=O),a&&a.abort(),i&&i.on.error.fire(f),b(function(){r(f)||Pe.on("error").fire(f)})}}t=[].slice.call(arguments,1,arguments.length-1),n=arguments[arguments.length-1];var i=M.PSD&&M.PSD.trans;i&&i.db===Pe&&-1===e.indexOf("!")||(i=null);var a=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");var s=Array.isArray(t[0])?t.reduce(function(e,t){return e.concat(t)}):t,c=null,l=s.map(function(e){return"string"==typeof e?e:(e instanceof z||(c=c||new he("Invalid type. Arguments following mode must be instances of Table or String")),e.name)});return"r"==e||e==Ce?e=Ce:"rw"==e||e==Ie?e=Ie:c=new ge("Invalid transaction mode: "+e),i&&(c||(i&&i.mode===Ce&&e===Ie&&(a?i=null:c=c||new ge("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),i&&l.forEach(function(e){i.tables.hasOwnProperty(e)||(a?i=null:c=c||new ge("Table "+e+" not included in parent transaction. Parent Transaction function: "+i.scopeFunc.toString()))}))),i?i._promise(e,r,"lock"):Pe._whenReady(r)},this.table=function(e){if(K&&De)return new J(e);if(!ve.hasOwnProperty(e))throw new ge("Table does not exist");return ve[e]},r(z.prototype,function(){function e(){throw new ge("Current Transaction is READONLY")}return{_trans:function(e,t,n){return this._tpf(e,[this.name],t,n)},_idbstore:function(e,t,n){if(K)return new M(t);var r=this;return this._tpf(e,[this.name],function(e,n,i){t(e,n,i.idbtrans.objectStore(r.name),i)},n)},get:function(e,t){var n=this;return this._idbstore(Ce,function(t,r,i){K&&t(n.schema.instanceTemplate);var o=i.get(e);o.onerror=F(r,["getting",e,"from",n.name]),o.onsuccess=function(){t(n.hook.reading.fire(o.result))}}).then(t)},where:function(e){return new V(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){var t=this;return K&&e(t.schema.instanceTemplate),this._idbstore(Ce,function(n,r,i){var o=i.openCursor();o.onerror=F(r,["calling","Table.each()","on",t.name]),ee(o,null,e,n,r,t.hook.reading.fire)})},toArray:function(e){var t=this;return this._idbstore(Ce,function(e,n,r){K&&e([t.schema.instanceTemplate]);var i=[],o=r.openCursor();o.onerror=F(n,["calling","Table.toArray()","on",t.name]),ee(o,null,function(e){i.push(e)},function(){e(i)},n,t.hook.reading.fire)}).then(e)},orderBy:function(e){return new this._collClass(new V(this,e))},toCollection:function(){return new this._collClass(new V(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&E(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(a.defineClass(e),e)},add:e,put:e,"delete":e,clear:e,update:e}}),i(J).from(z).extend(function(){return{add:function(e,t){var r=this,i=this.hook.creating.fire;return this._idbstore(Ie,function(o,a,c,l){var u={};if(i!==s){var d=t||(c.keyPath?k(e,c.keyPath):n),f=i.call(u,d,e,l);d===n&&f!==n&&(c.keyPath?x(e,c.keyPath,f):t=f)}var h=t?c.add(e,t):c.add(e);h.onerror=F(function(e){return u.onerror&&u.onerror(e),a(e)},["adding",e,"into",r.name]),h.onsuccess=function(t){var n=c.keyPath;n&&x(e,n,t.target.result),u.onsuccess&&u.onsuccess(t.target.result),o(h.result)}})},put:function(e,t){var r=this,i=this.hook.creating.fire,o=this.hook.updating.fire;return i!==s||o!==s?this._trans(Ie,function(i,o,a){var s=t||r.schema.primKey.keyPath&&k(e,r.schema.primKey.keyPath);s===n?a.tables[r.name].add(e).then(i,o):(a._lock(),e=P(e),a.tables[r.name].where(":id").equals(s).modify(function(t){this.value=e}).then(function(n){return 0===n?a.tables[r.name].add(e,t):s})["finally"](function(){a._unlock()}).then(i,o))}):this._idbstore(Ie,function(n,i,o){var a=t?o.put(e,t):o.put(e);a.onerror=F(i,["putting",e,"into",r.name]),a.onsuccess=function(t){var r=o.keyPath;r&&x(e,r,t.target.result),n(a.result)}})},"delete":function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e)["delete"]():this._idbstore(Ie,function(t,n,r){var i=r["delete"](e);i.onerror=F(n,["deleting",e,"from",r.name]),i.onsuccess=function(e){t(i.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection()["delete"]():this._idbstore(Ie,function(e,t,n){var r=n.clear();r.onerror=F(t,["clearing",n.name]),r.onsuccess=function(t){e(r.result)}})},update:function(e,t){if("object"!=typeof t||Array.isArray(t))throw new ge("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof e||Array.isArray(e))return this.where(":id").equals(e).modify(t);Object.keys(t).forEach(function(n){x(e,n,t[n])});var r=k(e,this.schema.primKey.keyPath);return r===n&&M.reject(new ge("Object does not contain its primary key")),this.where(":id").equals(r).modify(t)}}}),r(W.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&M.PSD&&(M.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(M.PSD&&(M.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{e()}catch(t){}}return this},_locked:function(){return this._reculock&&(!M.PSD||M.PSD.lockOwnerFor!==this)},_nop:function(e){this.tables[this.storeNames[0]].get(0).then(e)},_promise:function(e,t,n){var r=this;return M.newPSD(function(){var i;return r._locked()?i=new M(function(i,o){r._blockedFuncs.push(function(){r._promise(e,t,n).then(i,o)})}):(i=r.active?new M(function(i,o){if(!r.idbtrans&&e){if(!Se)throw new ge(ke?"Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+ke:"Database not open");var s=r.idbtrans=Se.transaction(R(r.storeNames),r.mode);s.onerror=function(e){r.on("error").fire(e&&e.target.error),e.preventDefault(),r.abort()},s.onabort=function(e){b(function(){r.on("error").fire(new ge("Transaction aborted for unknown reason"))}),r.active=!1,r.on("abort").fire(e)},s.oncomplete=function(e){r.active=!1,r.on("complete").fire(e)}}n&&r._lock();try{t(i,o,r)}catch(c){a.ignoreTransaction(function(){r.on("error").fire(c)}),r.abort(),o(c)}}):M.reject(_(new ge("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&n&&i["finally"](function(){r._unlock()})),i.onuncatched=function(e){a.ignoreTransaction(function(){r.on("error").fire(e)}),r.abort()},i})},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new ge("Transaction Aborted"))}catch(e){}},table:function(e){if(!this.tables.hasOwnProperty(e))throw new ge("Table "+e+" not in transaction");return this.tables[e]}}),r(V.prototype,function(){function e(e,t){try{throw t}catch(n){e._ctx.error=n}return e}function t(e){return Array.prototype.slice.call(1===e.length&&Array.isArray(e[0])?e[0]:e)}function n(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function i(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),s=-1,c=0;a>c;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):0>s?null:e.substr(0,s)+r[s]+n.substr(s+1)}function o(e,t,o){function a(e){s=n(e),c=r(e),l="next"===e?ne:re,u=s(o),d=c(o),f=e}var s,c,l,u,d,f;a("next"),e._ondirectionchange=function(e){a(e)},e._addAlgorithm(function(e,n,r){var o=e.key;if("string"!=typeof o)return!1;var a=c(o);if(t(a,d))return n(function(){e["continue"]()}),!0;var s=i(o,a,u,d,l,f);return n(s?function(){e["continue"](s)}:r),!1})}return{between:function(e,t,n,r){return n=n!==!1,r=r===!0,e>t||e===t&&(n||r)&&(!n||!r)?new this._ctx.collClass(this,function(){return fe.only(e)}).limit(0):new this._ctx.collClass(this,function(){return fe.bound(e,t,!n,!r)})},equals:function(e){return new this._ctx.collClass(this,function(){return fe.only(e)})},above:function(e){return new this._ctx.collClass(this,function(){return fe.lowerBound(e,!0)})},aboveOrEqual:function(e){return new this._ctx.collClass(this,function(){return fe.lowerBound(e)})},below:function(e){return new this._ctx.collClass(this,function(){return fe.upperBound(e,!0)})},belowOrEqual:function(e){return new this._ctx.collClass(this,function(){return fe.upperBound(e)})},startsWith:function(t){return"string"!=typeof t?e(new this._ctx.collClass(this),new he("String expected")):this.between(t,t+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(t){if("string"!=typeof t)return e(new this._ctx.collClass(this),new he("String expected"));if(""===t)return this.startsWith(t);var n=new this._ctx.collClass(this,function(){return fe.bound(t.toUpperCase(),t.toLowerCase()+String.fromCharCode(65535))});return o(n,function(e,t){return 0===e.indexOf(t)},t),n._ondirectionchange=function(){e(n,new ge("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},n},equalsIgnoreCase:function(t){if("string"!=typeof t)return e(new this._ctx.collClass(this),new he("String expected"));var n=new this._ctx.collClass(this,function(){return fe.bound(t.toUpperCase(),t.toLowerCase())});return o(n,function(e,t){return e===t},t),n},anyOf:function(e){var n=this._ctx,r=n.table.schema,i=n.index?r.idxByName[n.index]:r.primKey,o=i&&i.compound,a=t(arguments),s=o?ie(ne):ne;if(a.sort(s),0===a.length)return new this._ctx.collClass(this,function(){return fe.only("")}).limit(0);var c=new this._ctx.collClass(this,function(){return fe.bound(a[0],a[a.length-1])});c._ondirectionchange=function(e){s="next"===e?ne:re,o&&(s=ie(s)),a.sort(s)};var l=0;return c._addAlgorithm(function(e,t,n){for(var r=e.key;s(r,a[l])>0;)if(++l,l===a.length)return t(n),!1;return 0===s(r,a[l])?(t(function(){e["continue"]()}),!0):(t(function(){e["continue"](a[l])}),!1)}),c},notEqual:function(e){return this.below(e).or(this._ctx.index).above(e)},noneOf:function(e){var n=this._ctx,r=n.table.schema,i=n.index?r.idxByName[n.index]:r.primKey,o=i&&i.compound,a=t(arguments);if(0===a.length)return new this._ctx.collClass(this);var s=o?ie(ne):ne;a.sort(s);var c=a.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[null,t]]},null);c.push([a[a.length-1],null]);var l=this,u=n.index;return c.reduce(function(e,t){return e?null===t[1]?e.or(u).above(t[0]):e.or(u).between(t[0],t[1],!1,!1):l.below(t[1])},null)},startsWithAnyOf:function(n){function r(e){return e>s[l]}function i(e){return e<a[l]}var o=this._ctx,a=t(arguments);if(!a.every(function(e){return"string"==typeof e}))return e(new o.collClass(this),new he("startsWithAnyOf() only works with strings"));if(0===a.length)return new o.collClass(this,function(){return fe.only("")}).limit(0);var s=a.map(function(e){return e+String.fromCharCode(65535)}),c=ne;a.sort(c);var l=0,u=r,d=new o.collClass(this,function(){return fe.bound(a[0],a[a.length-1]+String.fromCharCode(65535))});return d._ondirectionchange=function(e){"next"===e?(u=r,c=ne):(u=i,c=re),a.sort(c),s.sort(c)},d._addAlgorithm(function(e,t,n){for(var r=e.key;u(r);)if(++l,l===a.length)return t(n),!1;return r>=a[l]&&r<=s[l]?(t(function(){e["continue"]()}),!0):(t(function(){c===ne?e["continue"](a[l]):e["continue"](s[l])}),!1)}),d}}}),r(G.prototype,function(){function e(e,t){e.filter=oe(e.filter,t)}function t(e,t){e.isMatch=oe(e.isMatch,t)}function n(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new ge("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return e.isPrimKey?t:t.index(n.name)}function r(e,t){return n(e,t)[e.op](e.range||null,e.dir+e.unique)}function i(e,t,n,i,o){e.or?!function(){function a(){2===++u&&n()}function s(e,n,r){if(!c||c(n,r,a,i)){var o=n.primaryKey.toString();l.hasOwnProperty(o)||(l[o]=!0,t(e,n,r))}}var c=e.filter,l={},u=(e.table.schema.primKey.keyPath,0);e.or._iterate(s,a,i,o),ee(r(e,o),e.algorithm,s,a,i,e.table.hook.reading.fire)}():ee(r(e,o),oe(e.algorithm,e.filter),t,n,i,e.table.hook.reading.fire)}function o(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,function(e,t){t(n.error)}):n.table._idbstore(Ce,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,function(e,n){n(t.error)}):t.table._idbstore(Ie,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=oe(t.algorithm,e)},_iterate:function(e,t,n,r){return i(this._ctx,e,t,n,r)},each:function(e){var t=this._ctx;return K&&e(o(t)),this._read(function(n,r,o){i(t,e,n,r,o)})},count:function(e){if(K)return M.resolve(0).then(e);var t=this,r=this._ctx;if(r.filter||r.algorithm||r.or){var o=0;return this._read(function(e,t,n){i(r,function(){return++o,!1},function(){e(o)},t,n)},e)}return this._read(function(e,i,o){var a=n(r,o),s=r.range?a.count(r.range):a.count();s.onerror=F(i,["calling","count()","on",t.name]),s.onsuccess=function(t){e(Math.min(t.target.result,Math.max(0,r.limit-r.offset)))}},e)},sortBy:function(e,t){function n(e,t){return t?n(e[i[t]],t-1):e[o]}function r(e,t){var r=n(e,a),i=n(t,a);return i>r?-s:r>i?s:0}var i=(this._ctx,e.split(".").reverse()),o=i[0],a=i.length-1,s="next"===this._ctx.dir?1:-1;return this.toArray(function(e){return e.sort(r)}).then(t)},toArray:function(e){var t=this._ctx;return this._read(function(e,n,r){K&&e([o(t)]);var a=[];i(t,function(e){a.push(e)},function(){e(a)},n,r)},e)},offset:function(t){var n=this._ctx;return 0>=t?this:(n.offset+=t,n.or||n.algorithm||n.filter?e(n,function(e,n,r){return--t<0}):e(n,function(e,n,r){return 0===t?!0:1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1)}),this)},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),e(this._ctx,function(e,n,r){return--t<=0&&n(r),t>=0}),this},until:function(t,n){var r=this._ctx;return K&&t(o(r)),e(this._ctx,function(e,r,i){return t(e.value)?(r(i),n):!0}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},and:function(n){return K&&n(o(this._ctx)),e(this._ctx,function(e){return n(e.value)}),t(this._ctx,n),this},or:function(e){return new V(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return K&&e(k(o(this._ctx),this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),t.isPrimKey||(t.op="openKeyCursor"),this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},keys:function(e){var t=this._ctx;t.isPrimKey||(t.op="openKeyCursor");var n=[];return K?new M(this.eachKey.bind(this)).then(function(e){return[e]}).then(e):this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t={};return e(this._ctx,function(e){var n=e.primaryKey.toString(),r=t.hasOwnProperty(n);return t[n]=!0,!r}),this}}}),i(Y).from(G).extend({modify:function(e){var t=this,n=this._ctx,i=n.table.hook,o=i.updating.fire,a=i.deleting.fire;return K&&"function"==typeof e&&e.call({value:n.table.schema.instanceTemplate},n.table.schema.instanceTemplate),this._write(function(i,c,l,u){function d(e,t,r){D=t.primaryKey;var i={primKey:t.primaryKey,value:e};if(g.call(i,e)!==!1){var o=!i.hasOwnProperty("value"),a=o?t["delete"]():t.update(i.value);++v,a.onerror=F(function(e){return w.push(e),C.push(i.primKey),i.onerror&&i.onerror(e),h(),!0},o?["deleting",e,"from",n.table.name]:["modifying",e,"on",n.table.name]),a.onsuccess=function(e){i.onsuccess&&i.onsuccess(i.value),++b,h()}}else i.onsuccess&&i.onsuccess(i.value)}function f(e){return e&&(w.push(e),C.push(D)),c(new A("Error modifying one or more objects",w,b,C))}function h(){S&&b+w.length===v&&(w.length>0?f():i(b))}var g;if("function"==typeof e)g=o===s&&a===s?e:function(t){var n=P(t);if(e.call(this,t)===!1)return!1;if(this.hasOwnProperty("value")){var r=T(n,this.value),i=o.call(this,r,this.primKey,n,u);i&&(t=this.value,Object.keys(i).forEach(function(e){x(t,e,i[e])}))}else a.call(this,this.primKey,t,u)};else if(o===s){var p=Object.keys(e),m=p.length;g=function(t){for(var n=!1,r=0;m>r;++r){var i=p[r],o=e[i];k(t,i)!==o&&(x(t,i,o),n=!0)}return n}}else{var y=e;e=I(y),g=function(t){var n=!1,i=o.call(this,e,this.primKey,P(t),u);return i&&r(e,i),Object.keys(e).forEach(function(r){var i=e[r];k(t,r)!==i&&(x(t,r,i),n=!0)}),i&&(e=I(y)),n}}var v=0,b=0,S=!1,w=[],C=[],D=null;t._iterate(d,function(){S=!0,h()},f,l)})},"delete":function(){return this.modify(function(){delete this.value})}}),r(this,{Collection:G,Table:z,Transaction:W,Version:h,WhereClause:V,WriteableCollection:Y,WriteableTable:J}),u(),le.forEach(function(e){e(Pe)})}function s(){}function c(e){return e}function l(e,t){return e===c?t:function(n){return t(e(n))}}function u(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function d(e,t){return e===s?t:function(){var r=e.apply(this,arguments);r!==n&&(arguments[0]=r);var i=this.onsuccess,o=this.onerror;delete this.onsuccess,delete this.onerror;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?u(i,this.onsuccess):i),o&&(this.onerror=this.onerror?u(o,this.onerror):o),a!==n?a:r}}function f(e,t){return e===s?t:function(){var i=e.apply(this,arguments);i!==n&&r(arguments[0],i);var o=this.onsuccess,a=this.onerror;delete this.onsuccess,delete this.onerror;var s=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?u(o,this.onsuccess):o),a&&(this.onerror=this.onerror?u(a,this.onerror):a),i===n?s===n?n:s:s===n?i:r(i,s)}}function h(e,t){return e===s?t:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function g(e,t){return e===s?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function p(e,t){return e===s?t:function(){e.apply(this,arguments),t.apply(this,arguments)}}function m(e,t){return e===s?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){var r=this,i=arguments;return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}function y(t,n){function r(e,t,n){if(Array.isArray(e))return o(e);if("object"==typeof e)return i(e);t||(t=h),n||(n=s);var r={subscribers:[],fire:n,subscribe:function(e){r.subscribers.push(e),r.fire=t(r.fire,e)},unsubscribe:function(e){r.subscribers=r.subscribers.filter(function(t){return t!==e}),r.fire=r.subscribers.reduce(t,n)}};return c[e]=l[e]=r,r}function i(t){Object.keys(t).forEach(function(n){var i=t[n];if(Array.isArray(i))r(n,t[n][0],t[n][1]);else{if("asap"!==i)throw new Error("Invalid event config");var o=r(n,null,function(){var t=arguments;o.subscribers.forEach(function(n){b(function(){n.apply(e,t)})})});o.subscribe=function(e){-1===o.subscribers.indexOf(e)&&o.subscribers.push(e)},o.unsubscribe=function(e){var t=o.subscribers.indexOf(e);-1!==t&&o.subscribers.splice(t,1)}}})}function o(e){function t(){return n?!1:void(n=!0)}var n=!1;e.forEach(function(e){r(e).subscribe(t)})}var a=arguments,c={},l=function(e,n){if(n){var r=[].slice.call(arguments,1),i=c[e];return i.subscribe.apply(i,r),t}return"string"==typeof e?c[e]:void 0};l.addEventType=r;for(var u=1,d=a.length;d>u;++u)r(a[u]);return l}function v(e){if(!e)throw new Error("Assertion failed")}function b(t){e.setImmediate?setImmediate(t):setTimeout(t,0)}function S(e){var t=setTimeout(e,1e3);clearTimeout(t)}function w(e,t,n){return function(){var r=M.PSD;M.PSD=n;try{e.apply(this,arguments)}catch(i){t(i)}finally{M.PSD=r}}}function k(e,t){if(e.hasOwnProperty(t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],i=0,o=t.length;o>i;++i){var a=k(e,t[i]);r.push(a)}return r}var s=t.indexOf(".");if(-1!==s){var c=e[t.substr(0,s)];return c===n?n:k(c,t.substr(s+1))}return n}function x(e,t,r){if(e&&t!==n)if("string"!=typeof t&&"length"in t){v("string"!=typeof r&&"length"in r);for(var i=0,o=t.length;o>i;++i)x(e,t[i],r[i])}else{var a=t.indexOf(".");if(-1!==a){var s=t.substr(0,a),c=t.substr(a+1);if(""===c)r===n?delete e[s]:e[s]=r;else{var l=e[s];l||(l=e[s]={}),x(l,c,r)}}else r===n?delete e[t]:e[t]=r}}function C(e,t){"string"==typeof t?x(e,t,n):"length"in t&&[].map.call(t,function(t){x(e,t,n)})}function I(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function P(e){if(!e||"object"!=typeof e)return e;var t;if(Array.isArray(e)){t=[];for(var n=0,r=e.length;r>n;++n)t.push(P(e[n]))}else if(e instanceof Date)t=new Date,t.setTime(e.getTime());else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e)e.hasOwnProperty(i)&&(t[i]=P(e[i]))}return t}function T(e,t){var r={};for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)?e[i]!==t[i]&&JSON.stringify(e[i])!=JSON.stringify(t[i])&&(r[i]=t[i]):r[i]=n);for(var i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(r[i]=t[i]);return r}function D(e){if("function"==typeof e)return new e;if(Array.isArray(e))return[D(e[0])];if(e&&"object"==typeof e){var t={};return E(t,e),t}return e}function E(e,t){Object.keys(t).forEach(function(n){var r=D(t[n]);e[n]=r})}function F(e,t){return function(n){var r=n&&n.target.error||new Error;if(t){var i=" occurred when "+t.map(function(e){switch(typeof e){case"function":return e();case"string":return e;default:return JSON.stringify(e)}}).join(" ");r.name?r.toString=function(){return r.name+i+(r.message?". "+r.message:"")}:r+=i}return e(r),n&&(n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()),!1}}function _(e){try{throw e}catch(t){return t}}function O(e){e.preventDefault()}function N(e){var t,n=a.dependencies.localStorage;if(!n)return e([]);try{t=JSON.parse(n.getItem("Dexie.DatabaseNames")||"[]")}catch(r){t=[]}e(t)&&n.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function B(e,t,n,r,i,o,a){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=i,this.compound=o,this.dotted=a;var s="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+s}function L(e,t,n,r){this.name=e,this.primKey=t||new B,this.indexes=n||[new B],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=n.reduce(function(e,t){return e[t.name]=t,e},{})}function A(e,t,n,r){this.name="ModifyError",this.failures=t,this.failedKeys=r,this.successCount=n,this.message=t.join("\n")}function R(e){return 1===e.length?e[0]:e}function j(){var e=a.dependencies.indexedDB,t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}var M=function(){function t(e,t){v.push([e,h.call(arguments,1)])}function n(){var t=v;v=[];for(var n=0,r=t.length;r>n;++n){var i=t[n];i[0].apply(e,i[1])}}function r(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var t=this,n=!0;this._PSD=r.PSD;try{f(this,e,function(e){n?p(c,t,e):c(t,e)},function(e){return n?(p(l,t,e),!1):l(t,e)})}finally{n=!1}}function i(e,i){if(null===e._state)return void e._deferreds.push(i);var o=e._state?i.onFulfilled:i.onRejected;if(null===o)return(e._state?i.resolve:i.reject)(e._value);var s,c=m;m=!1,p=t;try{var l=r.PSD;r.PSD=e._PSD,s=o(e._value),e._state||s&&"function"==typeof s.then&&s._state===!1||a(e),i.resolve(s)}catch(u){var d=i.reject(u);if(!d&&e.onuncatched)try{e.onuncatched(u)}catch(u){}}finally{if(r.PSD=l,c){do{for(;v.length>0;)n();var f=b.pop();if(f)try{f()}catch(u){}}while(b.length>0||v.length>0);p=g,m=!0}}}function o(e){var r=m;m=!1,p=t;try{e()}finally{if(r){do{for(;v.length>0;)n();var i=b.pop();if(i)try{i()}catch(o){}}while(b.length>0||v.length>0);p=g,m=!0}}}function a(e){e._catched=!0,e._parent&&a(e._parent)}function c(e,t){var n=r.PSD;r.PSD=e._PSD;try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)return void f(e,function(e,n){t.then(e,n)},function(t){c(e,t)},function(t){l(e,t)});e._state=!0,e._value=t,u.call(e)}catch(i){l(i)}finally{r.PSD=n}}function l(e,t){var n=r.PSD;if(r.PSD=e._PSD,e._state=!1,e._value=t,u.call(e),!e._catched)try{e.onuncatched&&e.onuncatched(e._value),r.on.error.fire(e._value)}catch(i){}return r.PSD=n,e._catched}function u(){for(var e=0,t=this._deferreds.length;t>e;e++)i(this,this._deferreds[e]);this._deferreds=[]}function d(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function f(e,t,n,r){var i=!1;try{t(function(e){i||(i=!0,n(e))},function(t){return i?e._catched:(i=!0,r(t))})}catch(o){if(i)return;return r(o)}}var h=[].slice,g="undefined"==typeof setImmediate?function(t,n,r,i){var o=arguments;setTimeout(function(){t.apply(e,h.call(o,1))},0)}:setImmediate;S(function(){g=p=t=function(t){var n=arguments;setTimeout(function(){t.apply(e,h.call(n,1))},0)}});var p=g,m=!0,v=[],b=[];return r.on=y(null,"error"),r.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new r(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){r(o,e)},n)}e[o]=a,0===--i&&t(e)}catch(c){n(c)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},r.prototype.then=function(e,t){var n=this,o=new r(function(r,o){null===n._state?i(n,new d(e,t,r,o)):p(i,n,new d(e,t,r,o))});return o._PSD=this._PSD,o.onuncatched=this.onuncatched,o._parent=this,o},r.prototype._then=function(e,t){i(this,new d(e,t,s,s))},r.prototype["catch"]=function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):r.reject(e)}):this.then(null,function(e){return e&&e.name===t?n(e):r.reject(e)})},r.prototype["finally"]=function(e){return this.then(function(t){return e(),t},function(t){return e(),r.reject(t)})},r.prototype.onuncatched=null,r.resolve=function(e){var t=new r(function(){});return t._state=!0,t._value=e,t},r.reject=function(e){var t=new r(function(){});return t._state=!1,t._value=e,t},r.race=function(e){return new r(function(t,n){e.map(function(e){e.then(t,n)})})},r.PSD=null,r.newPSD=function(e){var t=r.PSD;r.PSD=t?Object.create(t):{};try{return e()}finally{r.PSD=t}},r._rootExec=o,r._tickFinalize=function(e){if(m)throw new Error("Not in a virtual tick");b.push(e)},r}(),q=function(){},K=!1;i(A).from(Error),a["delete"]=function(e){var t=new a(e),n=t["delete"]();return n.onblocked=function(e){return t.on("blocked",e),this},n},a.exists=function(e){return new a(e).open().then(function(e){return e.close(),!0},function(){return!1})},a.getDatabaseNames=function(e){return new M(function(e,t){var n=j();if(n){var r=n();r.onsuccess=function(t){e([].slice.call(t.target.result,0))},r.onerror=F(t)}else N(function(t){return e(t),!1})}).then(e)},a.defineClass=function(e){function t(t){t?r(this,t):K&&E(this,e)}return t},a.ignoreTransaction=function(e){return M.newPSD(function(){return M.PSD.trans=null,e()})},a.spawn=function(){return e.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),a.ignoreTransaction.apply(this,arguments)},a.vip=function(e){return M.newPSD(function(){return M.PSD.letThrough=!0,e()})},Object.defineProperty(a,"currentTransaction",{get:function(){return M.PSD&&M.PSD.trans||null}}),a.Promise=M,a.derive=i,a.extend=r,a.override=o,a.events=y,a.getByKeyPath=k,a.setByKeyPath=x,a.delByKeyPath=C,a.shallowClone=I,a.deepClone=P,a.addons=[],a.fakeAutoComplete=q,a.asap=b,a.ModifyError=A,a.MultiModifyError=A,a.IndexSpec=B,a.TableSchema=L;var U=e.idbModules&&e.idbModules.shimIndexedDB?e.idbModules:{};a.dependencies={indexedDB:U.shimIndexedDB||e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:U.IDBKeyRange||e.IDBKeyRange||e.webkitIDBKeyRange,IDBTransaction:U.IDBTransaction||e.IDBTransaction||e.webkitIDBTransaction,Error:e.Error||String,SyntaxError:e.SyntaxError||String,TypeError:e.TypeError||String,DOMError:e.DOMError||String,localStorage:null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:e.localStorage},a.version=1.2,t("Dexie",a),S(function(){a.fakeAutoComplete=q=S,a.fake=K=!0})}).apply(null,"function"==typeof define&&define.amd?[self||window,function(e,t){define(function(){return t})}]:"undefined"!=typeof global&&"undefined"!=typeof module&&module.exports?[global,function(e,t){module.exports=t}]:[self||window,function(e,t){(self||window)[e]=t}]);var db=new Dexie("seshi");db.version(1).stores({chunks:"[fileId+chunkNumber],*fileId, boxId"}),db.open()["catch"](function(e){alert("Oh oh : "+e)});var signalServerDb=new Dexie("seshiSignalServers");signalServerDb.version(1).stores({signalServers:"&address,lastSuccessfulConnectTimestamp, lastConnectAttempTimestamp,numFailedConnectAttempts"}),signalServerDb.open()["catch"](function(e){alert("Oh no! : "+e);
});var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),RTCPeerConnection=function(e,t){return maybeFixConfiguration(e),new mozRTCPeerConnection(e,t)},window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,window.createIceServer=function(e,t,n){var r=null,i=e.split(":");if(0===i[0].indexOf("stun"))r={url:e};else if(0===i[0].indexOf("turn"))if(27>webrtcDetectedVersion){var o=e.split("?");(1===o.length||0===o[1].indexOf("transport=udp"))&&(r={url:o[0],credential:n,username:t})}else r={url:e,credential:n,username:t};return r},window.createIceServers=function(e,t,n){for(var r=[],i=0;i<e.length;i++){var o=window.createIceServer(e[i],t,n);null!==o&&r.push(o)}return r},attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject};else if(navigator.webkitGetUserMedia){webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedVersion=null!==result?parseInt(result[2],10):999,window.createIceServer=function(e,t,n){var r=null,i=e.split(":");return 0===i[0].indexOf("stun")?r={url:e}:0===i[0].indexOf("turn")&&(r={url:e,credential:n,username:t}),r},window.createIceServers=function(e,t,n){var r=[];if(webrtcDetectedVersion>=34)r={urls:e,credential:n,username:t};else for(var i=0;i<e.length;i++){var o=window.createIceServer(e[i],t,n);null!==o&&r.push(o)}return r},RTCPeerConnection=function(e,t){return 34>webrtcDetectedVersion&&maybeFixConfiguration(e),new webkitRTCPeerConnection(e,t)},getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(e,t){"undefined"!=typeof e.srcObject?e.srcObject=t:"undefined"!=typeof e.mozSrcObject?e.mozSrcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src}}else console.log("Browser does not appear to be WebRTC-capable");var createSignalingChannel=function(e,t){function n(e){function t(){if(this.readyState==this.DONE){if(200==this.status&&null!=this.response){var t=JSON.parse(this.response);return t.err?void e("error:  "+t.err):(s=t.id,c=t.status,r(),void("waiting"===c?d():(f(),call())))}return void e("HTTP error:  "+this.status)}}var e="function"==typeof e||function(){},n=new XMLHttpRequest;n.onreadystatechange=t,n.open("GET","https://signal.seshi.io/connect?key="+Seshi.getKey()),n.send()}function r(){var e=function(){function e(){r=10,i=1}function t(){i+=1,i>20?r=1e3:i>10&&(r=100)}function n(){return r}var r=10,i=1;return{reset:e,increase:t,value:n}}();!function t(){i(function(n){var r,i=n&&n.msgs||[];if(n.msgs&&"connected"!==c&&(c="connected",f()),i.length>0)for(e.reset(),r=0;r<i.length;r+=1)o(i[r]);else e.increase();setTimeout(t,e.value())})}()}function i(e){function t(){if(this.readyState==this.DONE){if(200==this.status&&null!=this.response){var t=JSON.parse(this.response);return t.err?void e("error:  "+t.err):(e(t),t)}return void e("HTTP error:  "+this.status)}}var n=new XMLHttpRequest;n.onreadystatechange=t,n.open("POST","https://signal.seshi.io/get"),n.send(JSON.stringify({id:s}))}function o(e){setTimeout(function(){h(e)},0)}function a(e,t){function n(){if(this.readyState==this.DONE){if(200==this.status&&null!=this.response){var e=JSON.parse(this.response);return e.err?void t("error:  "+e.err):void t(e)}return void t("HTTP error:  "+this.status)}}var r=new XMLHttpRequest;r.onreadystatechange=n,r.open("POST","https://signal.seshi.io/send");var i={id:s,message:e};r.send(JSON.stringify(i))}var s,c,l=function(){},t=t||{},u=function(e){return"function"==typeof e&&e||l},d=u(t.onWaiting),f=u(t.onConnected),h=u(t.onMessage);return{connect:n,send:a}};window.onload=function(){},processRecieveBufferFLAG=!1,Seshi={welcome:function(){var e="🚀  Welcome to Seshi! 🚀\n\nLet's rock the boat...\n\n\nType Seshi.help() for help.. \n\n\n";return console.log(e),e}(),config:{SeshiBotOn:!1,YoloInitMsg:!1},init:function(){return onPeerConnectionEstablished=new Event("onPeerConnectionEstablished"),onPeerConnectionEstablished.initEvent("onPeerConnectionEstablished",!0,!0),onPeerConnectionBroken=new Event("onPeerConnectionBroken"),onPeerConnectionBroken.initEvent("onPeerConnectionBroken",!0,!0),gotRemoteFileList=new Event("gotRemoteFileList"),gotRemoteFileList.initEvent("gotRemoteFileList",!0,!0),onNewChatMessage=new Event("onNewChatMessage"),onNewChatMessage.initEvent("onNewChatMessage",!0,!0),storeFilesProgressUpdate=new Event("storeFilesProgressUpdate"),storeFilesProgressUpdate.initEvent("storeFilesProgressUpdate",!0,!0),sendFileProgressUpdate=new Event("sendFileProgressUpdate"),sendFileProgressUpdate.initEvent("sendFileProgressUpdate",!0,!0),onGotRemoteDisplayName=new Event("onGotRemoteDisplayName"),onGotRemoteDisplayName.initEvent("onGotRemoteDisplayName",!0,!0),onPlayInSyncRequest=new Event("onPlayInSyncRequest"),onPlayInSyncRequest.initEvent("onPlayInSyncRequest",!0,!0),SeshiSkinPlay=new Event("SeshiSkinPlay"),SeshiSkinPlay.initEvent("SeshiSkinPlay",!0,!0),SeshiSkinPause=new Event("SeshiSkinPause"),SeshiSkinPause.initEvent("SeshiSkinPause",!0,!0),onSeshiPauseReq=new Event("onSeshiPauseReq"),onSeshiPauseReq.initEvent("onSeshiPauseReq",!0,!0),window.addEventListener("SeshiSkinPlay",Seshi.playHandler,!1),window.addEventListener("SeshiSkinPause",Seshi.pauseHandler,!1),StorageWorker=new Worker("js/workers/storeFileDexieWorker.js"),StorageWorker.onmessage=function(e){var t=e.data;void 0===Seshi.storeProgress[t.fileId]?currentChunk=0:currentChunk=Seshi.storeProgress[t.fileId].currentChunk,Seshi.storeProgress[t.fileId]={fileName:t.fileName,currentChunk:currentChunk+1,totalNumChunks:t.totalNumChunks,complete:currentChunk>=t.totalNumChunks?!0:!1,UIdone:!1},dispatchEvent(storeFilesProgressUpdate),1==Seshi.storeProgress[t.fileId].complete&&delete Seshi.storeProgress[t.fileId]},localStorage.getItem("localFilesList")||Seshi.updateLocalFilesList(),Seshi.signalingServers.buildList(),0==Seshi.signalingServers.list.length&&Seshi.addSignalingServer("seshi.io"),"It's 106 miles to Chicago; We got a full tank of gas; half a pack of cigarettes; its dark, and we're wearing sunglasses. Let's go!"},help:function(){return console.log("#\n# Usage:\n#  Seshi.help() -- This menu\n#  Seshi.connectionStatus -- Returns object of peer connection state for iceConnectionState & dataChannelState\n#  Seshi.generateKey() -- Returns a key (string) to be used when setting up a peer connection. This getts passed to the signalingServer.\n#  Seshi.store({'dataSource':'fileSystem || seshiChunk','data':this.files}) -- Store data into Seshi's Database\n#  Seshi.storeProgress -- Arrary indexed by fileId shows store progress e.g. for (var key in Seshi.storeProgress){Seshi.storeProgress[key];}\n#  Seshi.updateLocalFilesList() -- Refreshes the local file list\n#  Seshi.deleteFile(fileId) -- Delete file from Seshi\n#  Seshi.localFileList() -- Returns list of local files in Array of JSON objects\n#  Seshi.play(fileId, element) -- Playback a file (fileId) in your browser, attaching it as the src of (element) video or audio tag\n#  Seshi.sendLocalFileListToRemote -- Send local filelist to peer. Peer automatically sends theirs back populating Seshi.remoteFileList\n#  Seshi.download() -- Download a given fileId to the users local filesystem.\n#  Seshi.remoteFileList  -- Returns list of connected peers files (when connected)\n#  Seshi.sendFileToPeer(fileId) -- Send a file to peer over DataChannel. Must specify local FileId\n#  Seshi.setBoxId(boxName) -- Set Seshi.boxId , (similar to the folder concept, but more just a name to refer to a collection of files.\n#  Seshi.getBoxId() -- Returns the current Seshi.boxId name under which files will be stored.\n#  Seshi.syncData() -- Send all data to connecteed peer. This may take a while!\n#  Seshi.addSignalingServer(\"example.com\")  -- Add the address of additional signaling server(s)\n#\n\n\n#  ## The rest if Seshi is still being wrapped into the `Seshi.<call>` api ##\n#  ## for better code quality and to help make building user interfaces a much cleaner experience. ##\n#      These will probably be named:\n#          > Seshi.call() -- For contacting signaling server(s)\n#          > Seshi.connect() -- Establish connection between peers\n#          > Seshi.play() -- Returns blob url of file so UI can playback media. (see: https://goo.gl/mmPU9V)\n"),"🚀 🚀  Keep calm & Seshi on! 🚀 🚀"},connect:function(){connect()},connectionStatus:{iceConnectionState:function(){return"undefined"==typeof pc?"Not Started. Use Seshi.connect() to begin a peer connection":pc.iceConnectionState},dataChannelState:function(){return"undefined"==typeof dc?"Not Started. Use Seshi.call() after initiating peer connection with Seshi.connect()":dc.readyState}},signalingStatus:"",getSignalingStatus:function(){return Seshi.signalingStatus},setSignalingStatus:function(e){Seshi.signalingStatus=e},key:"",setKey:function(){var e=new Uint32Array(1);return window.crypto.getRandomValues(e),Seshi.key=e[0],localStorage.setItem("key",Seshi.getKey()),Seshi.getKey()},getKey:function(){return Seshi.key},getShareUrl:function(){var e=document.location.origin+"?key="+Seshi.getKey()+"#fileBoxes";return e},setDisplayName:function(e){localStorage.setItem("displayName",e),trace("Set display name to: "+Seshi.getDisplayName())},getDisplayName:function(){return localStorage.getItem("displayName")?localStorage.getItem("displayName"):""},sendLocalDisplayName:function(){var e={cmd:"remoteDisplayName",remoteDisplayName:Seshi.getDisplayName()};e=JSON.stringify(e),dc.send(e)},setRemoteDisplayName:function(e){localStorage.setItem("remoteDisplayName",e.remoteDisplayName),dispatchEvent(onGotRemoteDisplayName)},getRemoteDisplayName:function(){return localStorage.getItem("remoteDisplayName")?localStorage.getItem("remoteDisplayName"):""},updateLocalFilesList:function(){var e=new Promise(function(e,t){var n=new Worker("js/workers/getLocalFilesList.js");n.postMessage({cmd:"listFilesMeHearty"}),n.onmessage=function(t){console.log("Updating list of local files. Type: Seshi.localFileList for updated list"),e(localStorage.setItem("localFilesList",JSON.stringify(t.data.fileList)))}});return e},deleteFile:function(e){db.chunks.where("fileId").equals(e)["delete"]().then(function(t){console.log("Deleted: "+t+" chunks. Of fileId: "+e),Seshi.updateLocalFilesList()})},localFileList:function(){return JSON.parse(localStorage.getItem("localFilesList"))},remoteFileList:[],recvRemoteFileList:function(e){console.log("Received list of files from connected peer."),Seshi.remoteFileList=JSON.parse(e.data),dispatchEvent(gotRemoteFileList),msgRemoteFileList=JSON.stringify({chat:"Sucesfully recived your list of files, ta!\nSending mine now..",remoteDisplayName:"SeshiBOT"}),Seshi.config.SeshiBotOn&&dc.send(msgRemoteFileList),e.reply||(console.log("Replying back to peer with own local file listing..."),Seshi.sendLocalFileListToRemote(reply=!0))},store:function(e){console.log("In store.."),StorageWorker.postMessage(e)},storeProgress:[],sendLocalFileListToRemote:function(e){console.log("Should send my file list now over datachannel to peer.."),localFileList=JSON.stringify(Seshi.localFileList()),msgSendLocalFileList={cmd:"recvRemoteFileList",data:localFileList,reply:e},msgSendLocalFileList=JSON.stringify(msgSendLocalFileList),dc.send(msgSendLocalFileList),Seshi.sendLocalDisplayName()},generateObjectUrl:function(e){var t=new Promise(function(t,n){db.transaction("r",db.chunks,function(){db.chunks.where("fileId").equals(e).toArray(function(e){console.log("Found "+e.length+" chunks");for(var n=[],r=0;r<e.length;r++)n[r]=e[r].chunk;var i=new Blob(n,{type:e[0].fileType}),o=e[0].fileName;console.log(e[0].fileType),url=window.URL.createObjectURL(i),console.log("Data: "+url),t({objectURL:url,fileName:o,mimeType:e[0].fileType})})})["catch"](function(e){console.error(e)})});return t},play:function(e,t){db.transaction("r",db.chunks,function(){db.chunks.where("fileId").equals(e.fileId).toArray(function(e){console.log("Found "+e.length+" chunks");for(var n=[],r=0;r<e.length;r++)n[r]=e[r].chunk;var i=new Blob(n,{type:e[0].fileType});console.log(e[0].fileType),url=window.URL.createObjectURL(i),console.log("Data: "+url);var o=document.getElementById(t),a=window.URL.createObjectURL(i);o.src=a,o.addEventListener("canplay",function(){4==o.readyState&&o.play()})})["catch"](function(e){console.error(e)})})},pause:function(){dispatchEvent(onSeshiPauseReq)},isPlayable:function(e,t){if(e.includes("audio")||e.includes("video"))return!0;switch(e){case"audio/mp3":case"audio/ogg":case"audio/wave":case"audio/webm":case"audio/wav":case"audio/x-wav":case"audio/x-pn-wav":case"audio/x-aac":case"audio/midi":case"video/mp4":case"video/ogg":case"video/3gpp":case"video/quicktime":case"video/webm":case"video/mpeg":case"video/x-flv":case"video/x-msvideo":case"application/ogg":return!0}if(t){if(t=t.toLowerCase(),t.indexOf(".mp3")>-1)return!0;if(t.indexOf(".mp4")>-1)return!0;if(t.indexOf(".webm")>-1)return!0}return!1},playInSyncRequest:function(e){var t={cmd:"playInSyncRPC",request:"playRequest",fileId:e};t=JSON.stringify(t),dc.send(t);var n=new CustomEvent("playRequest",{detail:{fileId:e},bubbles:!0,cancelable:!0});dispatchEvent(n)},playInSyncRPC:function(e){function t(e){if(e==localStorage.getItem("currentlyPlaying")){var t=document.querySelector(".plyr");return void t.plyr.play()}var n=new CustomEvent("playRequest",{detail:{fileId:e},bubbles:!0,cancelable:!0});dispatchEvent(n)}function n(e){var t=new CustomEvent("resumePlayRequest",{detail:{fileId:e},bubbles:!0,cancelable:!0});dispatchEvent(t)}switch(e.request){case"playRequest":t(e.fileId);break;case"pause":Seshi.pause();break;case"play":n(fileId)}},playHandler:function(){console.log("In Seshi.playHandler");var e={cmd:"playInSyncRPC",request:"play"};e=JSON.stringify(e),dc.send(e)},pauseHandler:function(){trace("In Seshi.pauseHandler");var e={cmd:"playInSyncRPC",request:"pause"};e=JSON.stringify(e),dc.send(e)},download:function(e){db.transaction("r",db.chunks,function(){db.chunks.where("fileId").equals(e).toArray(function(e){console.log("Found "+e.length+" chunks");for(var t=[],n=0;n<e.length;n++)t[n]=e[n].chunk;var r=new Blob(t,{type:e[0].fileType});console.log(e[0].fileType),url=window.URL.createObjectURL(r),console.log("Data: "+url);var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=url,i.download=e[0].fileName,i.click()})}).then(function(){})["catch"](function(e){console.error(e)})},sendFileToPeer:function(e){return Seshi.flagProcessOutboxStarted=!0,"undefined"==typeof dc||"open"!=dc.readyState?(console.error("Seshi.sendFileToPeer(fileId) Tried to send file to peer but Datachannel is not open"),!1):void db.transaction("r",db.chunks,function(){db.chunks.where("fileId").equals(e).each(function(e){var t={fileId:e.fileId,chunkNumber:e.chunkNumber,chunkSize:e.chunkSize,numberOfChunks:e.numberOfChunks,fileType:e.fileType,fileName:e.fileName},n=JSON.stringify(t).length;n=zeroFill(n,64);var r={metaLength:n},i=JSON.stringify(r)+JSON.stringify(t),o=new Blob([i,e.chunk]);Seshi.outBox.push({percentComplete:(e.chunkNumber+1)/e.numberOfChunks*100,fileName:e.fileName,fileId:e.fileId,fileType:e.fileType,chunkNumber:e.chunkNumber,numberOfChunks:e.numberOfChunks,chunk:o}),Seshi.processOutbox(),Seshi.flagProcessOutboxStarted=!1}).then(function(){Seshi.flagProcessOutboxStarted=!0,Seshi.processOutbox()})})},outBox:[],flagProcessOutboxStarted:!0,processOutbox:function(){function e(){fr.onload=function(t){Seshi.outBox.length>=0&&(Seshi.buffer.push(t.target.result),Seshi.sendAllData(),0==Seshi.outBox.length&&(fr=void 0),e())},chunkData=Seshi.outBox.pop(),fr.readAsArrayBuffer(chunkData.chunk)}1==Seshi.flagProcessOutboxStarted&&"object"!=typeof fr&&(fr=new FileReader,e())},updateSendingProgress:function(e){void 0===Seshi.sendingFileProgress[e.fileId]?recvChunkCount=0:recvChunkCount=Seshi.sendingFileProgress[e.fileId].recvChunkCount,Seshi.sendingFileProgress[e.fileId]={percentComplete:(e.chunkNumber+1)/e.numberOfChunks*100,fileName:e.fileName,fileId:e.fileId,fileType:e.fileType,chunkNumber:e.chunkNumber,numberOfChunks:e.numberOfChunks,recvChunkCount:recvChunkCount+1,complete:recvChunkCount>=e.numberOfChunks?!0:!1,UIdone:!1},dispatchEvent(sendFileProgressUpdate),1==Seshi.sendingFileProgess[e.fileId].complete&&delete Seshi.sendingFileProgress[e.fileId]},bufferFullThreshold:4096,listener:function(){dc.removeEventListener("bufferedamountlow",Seshi.listener),Seshi.sendAllData()},sendAllData:function(){for(;Seshi.buffer.length>0;){if(dc.bufferedAmount>Seshi.bufferFullThreshold)return void dc.addEventListener("bufferedamountlow",Seshi.listener);dc.send(Seshi.buffer.shift())}},buffer:[],recvBuffer:[],sendingFileProgress:[],addSignalingServer:function(e){signalServerDb.signalServers.where("address").equalsIgnoreCase("seshi.io").count(function(t){0==t&&signalServerDb.signalServers.add({address:e,lastSuccessfulConnectTimestamp:null,lastConnectAttempTimestamp:null,numFailedConnectAttempts:null}).then(function(){console.log('Successfully Inserted signaling server "'+e+'"')})["catch"](function(e){console.error(e)})})},signalingServers:{list:[],buildList:function(){signalServerDb.transaction("r",signalServerDb.signalServers,function(){signalServerDb.signalServers.each(function(e){Seshi.signalingServers.list.push(e)})})}},requestFilesFromPeer:function(e){var e=JSON.stringify(e);msg={cmd:"requestFilesById",data:e},msg=JSON.stringify(msg),dc.send(msg)},sendRequestedFilesToPeer:function(e){console.log(e);for(var e=JSON.parse(e.data),t=0;t<e.length;t++)switch(e[t].requestType){case"ALL":Seshi.sendFileToPeer(e[t].fileId);break;case"CHUNK":console.log("Request for single chunk..");break;case"RANGE":console.log("Request for RANGE of chunks..");break;default:Seshi.sendFileToPeer(e[t])}},syncData:function(){db.transaction("r",db.chunks,function(){db.chunks.each(function(e){var t={fileId:e.fileId,chunkNumber:e.chunkNumber,chunkSize:e.chunkSize,numberOfChunks:e.numberOfChunks,fileType:e.fileType,fileName:e.fileName},n=JSON.stringify(t).length;n=zeroFill(n,64);var r={metaLength:n},i=JSON.stringify(r)+JSON.stringify(t),o=new Blob([i,e.chunk]),a=new FileReader;a.onload=function(e){if(a.readyState==FileReader.DONE){for(var t=0;99999999>=t;t++);dc.send(result=e.target.result)}},a.readAsArrayBuffer(o)})}).then(function(){console.log("All chunks (all files) sent to connected peer!")})["catch"](function(e){console.error(e)})},setBoxId:function(e){return Seshi.boxId=e,"Seshi.boxId is now set to: "+Seshi.boxId},getBoxId:function(){return Seshi.boxId},boxId:"myBoxID",trace:function(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}},Seshi.init();var signalingChannel,key,id,weWaited=!1,doNothing=function(){},pc,dc,data={},constraints={},fileMeta={};getQueryVariable("key")&&(Seshi.key=getQueryVariable("key"),localStorage.getItem("key")!=Seshi.key&&connect()),copyKeyBtn=document.getElementById("copyclipboard"),copyKeyBtn.addEventListener("click",createShareUrl,!1),$(function(){$('[data-toggle="tooltip"]').tooltip()});var sendBtn=document.getElementById("sendBtn");sendBtn.addEventListener("click",sendSelectedFiles,!1);var multiDeleteBtn=document.getElementById("multiDeleteLocalFiles");multiDeleteBtn.addEventListener("click",deleteSelectedFiles,!1);var multiDownloadBtn=document.getElementById("multiDownloadLocalFiles");multiDownloadBtn.addEventListener("click",function(){downloadSelectedFiles()},!1);var multiPullBtn=document.getElementById("receiveBtn");multiPullBtn.addEventListener("click",pullSelectedFiles,!1);var displayNameInput=document.getElementById("display-name");displayNameInput.value=Seshi.getDisplayName(),displayNameInput.addEventListener("keydown",setDisplayName,!1),displayNameInput.addEventListener("blur",setDisplayName,!1);var sendMsg=document.getElementById("sendMsg");sendMsg.addEventListener("click",function(){sendChat()}),window.addEventListener("onPeerConnectionEstablished",showConnected,!1),window.addEventListener("onPeerConnectionBroken",peerConnectionBroken,!1),window.addEventListener("gotRemoteFileList",function(){updateFileListDisplay(Seshi.remoteFileList,"remoteFileList")},!1),window.addEventListener("onNewChatMessage",newChatMessageReceived,!1),window.addEventListener("storeFilesProgressUpdate",updateStoreProgressDisplay,!1),window.addEventListener("sendFileProgressUpdate",updateSendFileProgessDisplay,!1),window.addEventListener("onGotRemoteDisplayName",showRemoteDisplayName,!1);var options={controls:["restart","rewind","play","fast-forward","current-time","duration","mute","volume","captions","fullscreen"]},player=plyr.setup()[0];if(window.addEventListener("playRequest",play,!1),window.addEventListener("resumePlayRequest",resumePlay,!1),window.addEventListener("onSeshiPauseReq",pause,!1),document.querySelector(".plyr").addEventListener("pause",function(){console.log("Pause button on Plyr was pressed.")}),document.querySelector(".plyr").addEventListener("play",function(){console.log("Play button on Plyr was pressed.")}),getQueryVariable("key")){generateKeyBtn=document.getElementById("connectionStatus");var connectionStatusMessage=document.createElement("p");connectionStatusMessage.id="connectionStatus",getQueryVariable("key")!=localStorage.getItem("key")?($("#sendIdThenHide").hide(),$("#connectionStatus").show(),connectionStatusMessageText=document.createTextNode("Connecting...")):connectionStatusMessageText=document.createTextNode("Hey! It looks like you've sent the key to yourself, send it to a friend to share files with them."),connectionStatusMessage.appendChild(connectionStatusMessageText);var parentDiv=generateKeyBtn.parentNode;parentDiv.replaceChild(connectionStatusMessage,generateKeyBtn)}updateFileListDisplay(Seshi.localFileList(),"localFileList");var localCheckAll=document.getElementById("checkAll-localFileList");localCheckAll.addEventListener("click",function(){tickAllFiles("checkAll-localFileList")},!1);var remoteCheckAll=document.getElementById("checkAll-remoteFileList");remoteCheckAll.addEventListener("click",function(){tickAllFiles("checkAll-remoteFileList")},!1),function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","colspan","align","valign"],tfoot:["align","valign"],th:["width","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}function i(e,t,n){}function o(e,t,n){}function a(e,t,n){}function s(e,t,n){}function c(e){return e.replace(C,"&lt;").replace(I,"&gt;")}function l(e,t,n,r){if(r=r||x,n=p(n),"href"===t||"src"===t){if(n=k.trim(n),"#"===n)return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(_.lastIndex=0,_.test(n))return""}else if("style"===t){if(O.lastIndex=0,O.test(n))return"";if(N.lastIndex=0,N.test(n)&&(_.lastIndex=0,_.test(n)))return"";n=r.process(n)}return n=m(n)}function u(e){return e.replace(P,"&quot;")}function d(e){return e.replace(T,'"')}function f(e){return e.replace(D,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function h(e){return e.replace(E,":").replace(F," ")}function g(e){for(var t="",n=0,r=e.length;r>n;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return k.trim(t)}function p(e){return e=d(e),e=f(e),e=h(e),e=g(e)}function m(e){return e=u(e),e=c(e)}function y(){return""}function v(e,t){function n(t){return r?!0:-1!==k.indexOf(e,t)}"function"!=typeof t&&(t=function(){});var r=!Array.isArray(e),i=[],o=!1;return{onIgnoreTag:function(e,r,a){if(n(e)){if(a.isClosing){var s="[/removed]",c=a.position+s.length;return i.push([o!==!1?o:a.position,c]),o=!1,s}return o||(o=a.position),"[removed]"}return t(e,r,a)},remove:function(e){var t="",n=0;return k.forEach(i,function(r){t+=e.slice(n,r[0]),n=r[1]}),t+=e.slice(n)}}}function b(e){return e.replace(B,"")}function S(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127===t?!1:31>=t?10===t||13===t?!0:!1:!0}),t.join("")}var w=e("cssfilter").FilterCSS,k=e("./util"),x=new w,C=/</g,I=/>/g,P=/"/g,T=/&quot;/g,D=/&#([a-zA-Z0-9]*);?/gim,E=/&colon;?/gim,F=/&newline;?/gim,_=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,O=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,N=/u\s*r\s*l\s*\(.*/gi,B=/<!--[\s\S]*?-->/g;n.whiteList=r(),n.getDefaultWhiteList=r,n.onTag=i,n.onIgnoreTag=o,n.onTagAttr=a,n.onIgnoreTagAttr=s,n.safeAttrValue=l,n.escapeHtml=c,n.escapeQuote=u,n.unescapeQuote=d,n.escapeHtmlEntities=f,n.escapeDangerHtml5Entities=h,n.clearNonPrintableCharacter=g,n.friendlyAttrValue=p,n.escapeAttrValue=m,n.onIgnoreTagStripAll=y,n.StripTagBody=v,n.stripCommentTag=b,n.stripBlankChar=S,n.cssFilter=x},{"./util":4,cssfilter:8}],2:[function(e,t,n){function r(e,t){var n=new a(t);return n.process(e)}var i=e("./default"),o=e("./parser"),a=e("./xss");n=t.exports=r,n.FilterXSS=a;for(var s in i)n[s]=i[s];for(var s in o)n[s]=o[s];"function"==typeof define&&define.amd&&define(function(){return t.exports}),"undefined"!=typeof window&&(window.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,n){function r(e){var t=e.indexOf(" ");if(-1===t)var n=e.slice(1,-1);else var n=e.slice(1,t+1);return n=d.trim(n).toLowerCase(),"/"===n.slice(0,1)&&(n=n.slice(1)),"/"===n.slice(-1)&&(n=n.slice(0,-1)),n}function i(e){return"</"===e.slice(0,2)}function o(e,t,n){"user strict";var o="",a=0,s=!1,c=!1,l=0,u=e.length,d="",f="";for(l=0;u>l;l++){var h=e.charAt(l);if(s===!1){if("<"===h){s=l;continue}}else if(c===!1){if("<"===h){o+=n(e.slice(a,l)),s=l,a=l;continue}if(">"===h){o+=n(e.slice(a,s)),d=e.slice(s,l+1),f=r(d),o+=t(s,o.length,f,d,i(d)),a=l+1,s=!1;continue}if(('"'===h||"'"===h)&&"="===e.charAt(l-1)){c=h;continue}}else if(h===c){c=!1;continue}}return a<e.length&&(o+=n(e.substr(a))),o}function a(e,t){"user strict";function n(e,n){if(e=d.trim(e),e=e.replace(f,"").toLowerCase(),!(e.length<1)){var r=t(e,n||"");r&&i.push(r)}}for(var r=0,i=[],o=!1,a=e.length,l=0;a>l;l++){var h,g,p=e.charAt(l);if(o!==!1||"="!==p)if(o===!1||l!==r||'"'!==p&&"'"!==p||"="!==e.charAt(l-1))if(" "!==p);else{if(o===!1){if(g=s(e,l),-1===g){h=d.trim(e.slice(r,l)),n(h),o=!1,r=l+1;continue}l=g-1;continue}if(g=c(e,l-1),-1===g){h=d.trim(e.slice(r,l)),h=u(h),n(o,h),o=!1,r=l+1;continue}}else{if(g=e.indexOf(p,l+1),-1===g)break;h=d.trim(e.slice(r+1,g)),n(o,h),o=!1,l=g,r=l+1}else o=e.slice(r,l),r=l+1}return r<e.length&&(o===!1?n(e.slice(r)):n(o,u(d.trim(e.slice(r))))),d.trim(i.join(" "))}function s(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function c(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function l(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]?!0:!1}function u(e){return l(e)?e.substr(1,e.length-2):e}var d=e("./util"),f=/[^a-zA-Z0-9_:\.\-]/gim;n.parseTag=o,n.parseAttr=a},{"./util":4}],4:[function(e,t,n){t.exports={indexOf:function(e,t){var n,r;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var r,i;if(Array.prototype.forEach)return e.forEach(t,n);for(r=0,i=e.length;i>r;r++)t.call(n,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")}}},{}],5:[function(e,t,n){function r(e){return void 0===e||null===e}function i(e){var t=e.indexOf(" ");if(-1===t)return{html:"",closing:"/"===e[e.length-2]};e=d.trim(e.slice(t+1,-1));var n="/"===e[e.length-1];return n&&(e=d.trim(e.slice(0,-1))),{html:e,closing:n}}function o(e){e=e||{},e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=s.onIgnoreTagStripAll),e.whiteList=e.whiteList||s.whiteList,e.onTag=e.onTag||s.onTag,e.onTagAttr=e.onTagAttr||s.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||s.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||s.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||s.safeAttrValue,e.escapeHtml=e.escapeHtml||s.escapeHtml,e.css=e.css||{},this.options=e,this.cssFilter=new a(e.css)}var a=e("cssfilter").FilterCSS,s=e("./default"),c=e("./parser"),l=c.parseTag,u=c.parseAttr,d=e("./util");o.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,o=n.whiteList,a=n.onTag,c=n.onIgnoreTag,f=n.onTagAttr,h=n.onIgnoreTagAttr,g=n.safeAttrValue,p=n.escapeHtml,m=t.cssFilter;n.stripBlankChar&&(e=s.stripBlankChar(e)),n.allowCommentTag||(e=s.stripCommentTag(e));var y=!1;if(n.stripIgnoreTagBody){var y=s.StripTagBody(n.stripIgnoreTagBody,c);c=y.onIgnoreTag}var v=l(e,function(e,t,n,s,l){var y={sourcePosition:e,position:t,isClosing:l,isWhite:n in o},v=a(n,s,y);if(!r(v))return v;if(y.isWhite){if(y.isClosing)return"</"+n+">";var b=i(s),S=o[n],w=u(b.html,function(e,t){var i=-1!==d.indexOf(S,e),o=f(n,e,t,i);if(!r(o))return o;if(i)return t=g(n,e,t,m),t?e+'="'+t+'"':e;var o=h(n,e,t,i);return r(o)?void 0:o}),s="<"+n;return w&&(s+=" "+w),b.closing&&(s+=" /"),s+=">"}var v=c(n,s,y);return r(v)?p(s):v},p);return y&&(v=y.remove(v)),v},t.exports=o},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,n){function r(e){return void 0===e||null===e}function i(e){e=e||{},e.whiteList=e.whiteList||o.whiteList,e.onAttr=e.onAttr||o.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||o.onIgnoreAttr,this.options=e}var o=e("./default"),a=e("./parser");e("./util");i.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,i=n.whiteList,o=n.onAttr,s=n.onIgnoreAttr,c=a(e,function(e,t,n,a,c){var l=i[n],u=!1;l===!0?u=l:"function"==typeof l?u=l(a):l instanceof RegExp&&(u=l.test(a)),u!==!0&&(u=!1);var d={position:t,sourcePosition:e,source:c,isWhite:u};if(u){var f=o(n,a,d);return r(f)?n+":"+a:f}var f=s(n,a,d);return r(f)?void 0:f});return c},t.exports=i},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,n){function r(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,
e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e["float"]=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function i(e,t,n){}function o(e,t,n){}n.whiteList=r(),n.getDefaultWhiteList=r,n.onAttr=i,n.onIgnoreAttr=o},{}],8:[function(e,t,n){function r(e,t){var n=new o(t);return n.process(e)}var i=e("./default"),o=e("./css");n=t.exports=r,n.FilterCSS=o;for(var a in i)n[a]=i[a];"function"==typeof define&&define.amd&&define(function(){return t.exports}),"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,n){function r(e,t){function n(){if(!o){var n=i.trim(e.slice(a,s)),r=n.indexOf(":");if(-1!==r){var l=i.trim(n.slice(0,r)),u=i.trim(n.slice(r+1));if(l){var d=t(a,c.length,l,u,n);d&&(c+=d+"; ")}}}a=s+1}e=i.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var r=e.length,o=!1,a=0,s=0,c="";r>s;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var u=e.indexOf("*/",s+2);if(-1===u)break;s=u+1,a=s+1,o=!1}else"("===l?o=!0:")"===l?o=!1:";"===l?o||n():"\n"===l&&n()}return i.trim(c)}var i=e("./util");t.exports=r},{"./util":10}],10:[function(e,t,n){t.exports={indexOf:function(e,t){var n,r;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var r,i;if(Array.prototype.forEach)return e.forEach(t,n);for(r=0,i=e.length;i>r;r++)t.call(n,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]);