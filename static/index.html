<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    </head>
    <body>
<!-- blank script section is placeholder for query params -->
<script></script>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

	<h1>Seshi</h1>
        <p>Seshi is the quickest way to send and enjoy files between devices.</p>
	<ol>
		<li>Choose a file to send. Seshi will store it in your browser.</li>
		<li>Choose a secret key &amp; click 'connect'</li>
		<li>Tell your friend the key, connect, and click the 'send' button'</li>
		<li>That's it! No limits, no email required, the file is sent <em>direct</em> to your friend</em></li> 
	</ol>
        <p>Store your file in Seshi: <input type="file" id="share" name="Store Files" /></p>
	<p>Type a key: <input type="text" name="key" id="key" placeholder="e.g. S1TR*ogN{Pas^Wr2" /> 
	<button id="generateKey">Or generate a key</button><p/>
	<p id="status"></p>
	    <button id="call" style="display:none" onclick = "call()">Connect</button>
	    <button id="hangup" onclick="dc.close()" style="display:none">Disconnect</button>
	<input type="text" id="Generate" style="display:none" />
        <p><button id="connect" onclick="connect()">Connect</button></p>
        <a href="#video_player" class="showFiles" href="#" role="button">View My Files</a>
	
	<!-- Media player -->
	   <figure id="video_player">
	      <video id="video" controls></video>
		<figcaption id="playlist">
		</figcaption>
	   </figure>

	<!-- End media player -->

	<!-- chatbox -->
	<textarea id="chatbox" placeholder="Chat window"></textarea>
	<input type="text" name="chat" id="chat" placeholder="Message..." onkeyup="if (event.keyCode == 13) { sendChat(); return false;}" /><br />
		<!-- Upload progress bar -->
		<div class="progress">
			<div id="uploadProgress">
				Uploading
			</div>
		</div>
		<!-- End Upload progress bar -->
	<!-- End chatbox -->

	<!-- FilesInBox --><div id="filesInBox"></div><!-- End FilesInBox -->
    </div>

          <h2>What is Seshi?</h2>
	  <p> Seshi started out of an idea to create a truly decentralised file sharing tool which would put people back in control of their own content. I was frustrated by parts of the internet being branded metaphorical highways for piracy and unimpressed by services being capable of creating peer to peer file sharing tools, but chosing to collect email addresses, and perform analytics on users data for re-marketing campaigns (even in recruitment campaigns ) thus loosing sight of the potential for pure peer to peer technologies.</p>
	  <p>Seshi is quite a geeky peice of tehnology, but it is nothing new. It's simply how its architected which makes it <em>different</em>. Seshi dosn't need Seshi.io in order to function, that is, the web server on which it runs is not required in order for people to connect to each other. You can, for example save the webpage locally and run it from there. Signalling is still needed of course (ie how do users find each other) and for this, finally a valid use case for QR codes is found. Seshi can generate QR codes containing your connection information which can be exchanged outside of the application (a so-called out of band communication). The codebase is split into two parts: Seshi Skin &amp; Seshi Signal, making it easier for developers to build their own interface whilst still plugging into Seshi's storage and p2p framework*.</p>

<p>*Seshi is not a framework, its codebase is a work-in-progress and an insult to good coding practises.</p>
	<h2>Media player built-in</h2>
          <p>Any file you store in Seshi can be played back to you right within your browser (if your browser supports it). You can, listen to your music, videos, and browse pictures.</p>
	  <p>A cool feature is the ability to watch a film in sync with a friend. Distance shouldn't stop two people from sharing a film! &lt;3 </p>
          <h2>Send to a friend</h2>
          <p>The whole point of Seshi is to make it easy &amp; fast to send files between friends removing as many barriers as possible (no email size limits, no account needed or speed restictions). Your only limit is your browser and speed of your device. Seshi works with Chrome and Firefox, there's a few quirks with Firefox at the moment when playing back sound / video.<p>

      <hr />

      <footer>
        <p>&copy; Seshi 2015</p>
      </footer>
    </div> <!-- /container -->        

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X','auto');ga('send','pageview');
        </script>

<!-- load Dexie.js for IndexedDB -->
<script src="Dexie.js" type="text/javascript"></script>
<script src="databaseSchema.js" type="text/javascript"></script>
<!-- load polyfill, local copy first for local testing -->
<script src="adapter.js" type="text/javascript"></script>

<!-- load XHR-based signaling channel that direct connects based
     on a key -->
<script src="clientXHRSignalingChannel.js"
        type="text/javascript"></script>
<script src="index.js" type="text/javascript"></script>
<script src="boxHandling.js"></script>

<script type="text/javascript">
/* Get fileList worker */
//Start worker on call to Seshi.getLocalFilesList()
Seshi = {
    init:(function(){console.log("ðŸš€  Welcome to Seshi! ðŸš€\n\nLet's rock the boat...\n\n\nType Seshi.help() for help.. \n\n\n")})(),
    help:function(){console.log("#\n" +
                        '# Usage:\n' + 
                        '#  Seshi.help() -- This menu\n' +
                        '#  Seshi.updateLocalFilesList() -- Refreshes the local file list\n' +
                        '#  Seshi.localFileList() -- Returns list of local files in Array of JSON objects\n' +
                        '#\n\n\n' +
                        '#  ## The rest if Seshi is still being wrapped into the `Seshi.<call>` api ##\n' +
                        '#  ## for better code quality and to help make building user interfaces a much cleaner experience. ##\n' + 
                        '#      These will probably be named:\n' + 
                        '#          > Seshi.call() -- For contacting signaling server(s)\n' + 
                        '#          > Seshi.connect() -- Establish connection between peers\n' +
                        '#          > Seshi.getRemoteFileList() -- Fetch list from peer of their local files.\n' + 
                        '#          > Seshi.storeFile(fileObj)\n' +
                        '#          > Seshi.play() -- Returns blob url of file so UI can playback media. (see: https://goo.gl/mmPU9V)\n' + 
                        '#          > Seshi.status() -- Returns connection status. Either "connected" to peer or "disconnected".'
            ); return "ðŸš€ ðŸš€  Keep calm & Seshi on! ðŸš€ ðŸš€"},
    updateLocalFilesList: function() {
                        /* 
                        #   UpdateLocalFilesList 
                        #   - Refreshes Seshi's list of local files cache -
                        #   
                        #   Calls a worker, defined in js/getLocalFilesList.js
                        #   The worker queries IndexedDB for the latest list of files.
                        #   This takes time (hence the cache)
                        #   When done, the worker posts a message back to Seshi
                        #   containing the most up-to-date list of files as an array 
                        #   of objects. Seshi updates it's 'cache' of the latest file 
                        #   list by Appending the list to Seshi.getLocalFileList. 
                        */
                        var LocalFilesListWorker= new Worker('js/workers/getLocalFilesList.js');
                        LocalFilesListWorker.postMessage({'cmd':'listFilesMeHearty'});
                        //Act of response from worker (the list of files)
                        LocalFilesListWorker.onmessage = function(event) {
                        console.log("Updating list of local files. Type: Seshi.localFileList for updated list");
                        Seshi.localFileList = event.data.fileList;;
                        }
                       },
    localFileList:[],
    remoteFileList:[],
    getRemoteFileList:function() {
    }
}//End Seshi :'(

</script>

</div>
<div id="scMessage" style="float:right;display:none">

  <p>Response:  <span id="response"></span></p>
</div>

<button id="SyncMyData" style="display:none">Sync All My Data</button></p>

<div class="debug hide">
<input id="chunkInProgress" type="text" value="Details of chunk being transferd will appear here" style="width:600px" /><br />
</div><!-- End progress log debug info -->

<hr />

<div id="iceMessages" class="debug hide">
 <div class="outMessages"> 
 <b>Outgoing Messages</b>
     <br/>
     <textarea id="outmessages" rows="20"
               style="width:450px;margin:0 15px;"></textarea>
 </div><!-- end outMessages -->
 <div class="inMessages">
  <b>Incoming Messages</b>
     <br/>
     <textarea id="inmessages" rows="20"
               style="width:450px"></textarea>
  </div><!-- end inMessages  -->

</div><!-- End iceMessages debug -->
<span id="statusline" style="display:none">Status:
      <span id="status">Disconnected</span>
    </span>


</body>

<button onclick="showDebugInfo()">Show debug info</button>
<p>A project of <a href="http://karmacomputing.co.uk">Karma Computing</a>.</p>
</html>
